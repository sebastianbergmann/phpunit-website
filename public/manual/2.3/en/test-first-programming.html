<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>PHPUnit Manual &#8211; Chapter 8. Test-First Programming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="https://phpunit.de/manual/current/en/test-first-programming.html">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/highlight.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700%7CSource+Code+Pro:400,700' rel='stylesheet' type='text/css'>
  <!--[if lt IE 9]><script src="js/html5shiv.min.js"></script><![endif]-->
 </head>
 <body>
  <nav class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-left">
            <li>
                <a href="https://phpunit.de/documentation.html">This documentation is outdated. Please follow this link to learn about the new documentation.</a>
            </li>
        </ul>
    </div>
  </nav>
  <div class="container-fluid">
   <div class="row">
    <div class="col-md-4 col-lg-3">
     <div class="well well-sm sidebar-nav">
<dl class="toc nav hidden-print"><dt><span class="preface"><a href="preface.html">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="preface.html#preface.requirements">Requirements</a></span></dt><dt><span class="section"><a href="preface.html#preface.license">This Book Is Free</a></span></dt><dt><span class="section"><a href="preface.html#preface.conventions">Conventions Used in This Book</a></span></dt><dt><span class="section"><a href="preface.html#preface.acknowledgements">Acknowledgements</a></span></dt></dl></dd><dt><span class="chapter"><a href="automating-tests.html">1. Automating Tests</a></span></dt><dt><span class="chapter"><a href="goals.html">2. PHPUnit's Goals</a></span></dt><dt><span class="chapter"><a href="installation.html">3. Installing PHPUnit</a></span></dt><dt><span class="chapter"><a href="textui.html">4. The Command-Line Test Runner</a></span></dt><dt><span class="chapter"><a href="fixtures.html">5. Fixtures</a></span></dt><dd><dl><dt><span class="section"><a href="fixtures.html#fixtures.more-setup-than-teardown">More setUp() than tearDown()</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.variations">Variations</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.suite-level-setup">Suite-Level Setup</a></span></dt></dl></dd><dt><span class="chapter"><a href="testing-exceptions-and-performance-regressions.html">6. Testing Exceptions and Performance Regressions</a></span></dt><dd><dl><dt><span class="section"><a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.exceptions">Exceptions</a></span></dt><dt><span class="section"><a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.performance-regressions">Performance Regressions</a></span></dt></dl></dd><dt><span class="chapter"><a href="incomplete-tests.html">7. Incomplete Tests</a></span></dt><dt><span class="chapter"><a href="test-first-programming.html" class="active">8. Test-First Programming</a></span></dt><dd><dl><dt><span class="section"><a href="test-first-programming.html#test-first-programming.bankaccount-example">BankAccount Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="code-coverage-analysis.html">9. Code-Coverage Analysis</a></span></dt><dt><span class="chapter"><a href="stubs.html">10. Stubs</a></span></dt><dd><dl><dt><span class="section"><a href="stubs.html#stubs.self-shunting">Self-Shunting</a></span></dt></dl></dd><dt><span class="chapter"><a href="other-uses-for-tests.html">11. Other Uses for Tests</a></span></dt><dd><dl><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.agile-documentation">Agile Documentation</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.cross-team-tests">Cross-Team Tests</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.debugging-tests">Debugging Tests</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.refactoring">Refactoring</a></span></dt></dl></dd><dt><span class="chapter"><a href="phing.html">12. PHPUnit and Phing</a></span></dt><dd><dl><dt><span class="section"><a href="phing.html#phing.formatting-feedback">Formatting Feedback</a></span></dt></dl></dd><dt><span class="chapter"><a href="implementation.html">13. PHPUnit's Implementation</a></span></dt><dt><span class="chapter"><a href="api.html">14. PHPUnit API</a></span></dt><dd><dl><dt><span class="section"><a href="api.html#api.overview">Overview</a></span></dt><dt><span class="section"><a href="api.html#api.assert">PHPUnit2_Framework_Assert</a></span></dt><dt><span class="section"><a href="api.html#api.test">PHPUnit2_Framework_Test</a></span></dt><dt><span class="section"><a href="api.html#api.testcase">PHPUnit2_Framework_TestCase</a></span></dt><dt><span class="section"><a href="api.html#api.testsuite">PHPUnit2_Framework_TestSuite</a></span></dt><dt><span class="section"><a href="api.html#api.testresult">PHPUnit2_Framework_TestResult</a></span></dt><dt><span class="section"><a href="api.html#api.package-structure">Package Structure</a></span></dt></dl></dd><dt><span class="chapter"><a href="extending-phpunit.html">15. Extending PHPUnit</a></span></dt><dd><dl><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_TestCase">Subclass PHPUnit2_Framework_TestCase</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.Assert">Assert Classes</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Extensions_TestDecorator">Subclass PHPUnit2_Extensions_TestDecorator</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_Test">Implement PHPUnit2_Framework_Test</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_TestResult">Subclass PHPUnit2_Framework_TestResult</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_TestListener">Implement PHPUnit2_Framework_TestListener</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.TestRunner">New Test Runner</a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.phpunit1.html">A. PHPUnit for PHP 4</a></span></dt><dt><span class="appendix"><a href="appendixes.index.html">B. Index</a></span></dt><dd><dl><dt><span class="index"><a href="appendixes.index.html#appendixes.index.index"></a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.bibliography.html">C. Bibliography</a></span></dt><dt><span class="appendix"><a href="appendixes.copyright.html">D. Copyright</a></span></dt></dl>
     </div>
    </div>
    <div class="col-md-8 col-lg-9">
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="incomplete-tests.html">Prev</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="code-coverage-analysis.html">Next</a></div>
     </div>
<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="test-first-programming"></a>Chapter 8. Test-First Programming</h1></div></div></div><div class="alert alert-warning"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    <a id="idm140250594825136" class="indexterm"></a>
    <a id="idm140250594824320" class="indexterm"></a>
    <a id="idm140250594823504" class="indexterm"></a>
    <a id="idm140250594751888" class="indexterm"></a>
    <a id="idm140250594751136" class="indexterm"></a>

    Unit Tests are a vital part of several software development practices
    and processes such as Test-First Programming,
    <a class="ulink" href="http://en.wikipedia.org/wiki/Extreme_Programming" target="_top">Extreme Programming</a>,
    and <a class="ulink" href="http://en.wikipedia.org/wiki/Test-driven_development" target="_top">Test-Driven Development</a>.
    They also allow for <a class="ulink" href="http://en.wikipedia.org/wiki/Design_by_Contract" target="_top">Design-by-Contract</a>
    in programming languages that do not support this methodology with
    language constructs.
  </p><p>
    You can use PHPUnit to write tests once you are done programming.
    However, the sooner a test is written after an error has been introduced,
    the more valuable the test is. So instead of writing tests months after
    the code is "complete", we can write tests days or hours or minutes after
    the possible introduction of a defect. Why stop there? Why not write the
    tests a little before the possible introduction of a defect?
  </p><p>
    Test-First Programming, which is part of Extreme Programming and
    Test-Driven Development, builds upon this idea and takes it to the
    extreme. With today's computational power, we have the opportunity to
    run thousands of tests thousands of times per day. We can use the
    feedback from all of these tests to program in small steps, each of
    which carries with it the assurance of a new automated test in addition
    to all the tests that have come before. The tests are like pitons,
    assuring you that, no matter what happens, once you have made progress
    you can only fall so far.
  </p><p>
    When you first write the test it cannot possibly run, because you are
    calling on objects and methods that have not been programmed yet. This
    might feel strange at first, but after a while you will get used to it.
    Think of Test-First Programming as a pragmatic approach to following the
    object-oriented programming principle of programming to an interface
    instead of programming to an implementation: while you are writing the
    test you are thinking about the interface of the object you are
    testing -- what does this object look like from the outside. When you
    go to make the test really work, you are thinking about pure
    implementation. The interface is fixed by the failing test.
  </p><p>
    What follows is necessarily an abbreviated introduction to Test-First
    Programming. You can explore the topic further in other books, such as
    <span class="emphasis"><em>Test-Driven Development</em></span> <a class="xref" href="appendixes.bibliography.html#Beck2002" title="Test Driven Development by Example">[<abbr class="abbrev">Beck2002</abbr>]</a>
    by Kent Beck or Dave Astels' <span class="emphasis"><em>A Practical Guide to Test-Driven
    Development</em></span> <a class="xref" href="appendixes.bibliography.html#Astels2003" title="Test Driven Development">[<abbr class="abbrev">Astels2003</abbr>]</a>.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="test-first-programming.bankaccount-example"></a>BankAccount Example</h2></div></div></div><p>
      In this chapter, we will look at the example of a class that represents
      a bank account. The contract for the <code class="literal">BankAccount</code>
      class not only requires methods to get and set the bank account's
      balance, as well as methods to deposit and withdraw money. It also
      specifies the following two conditions that must be ensured:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The bank account's initial balance must be zero.</p></li><li class="listitem"><p>The bank account's balance cannot become negative.</p></li></ul></div><p>
      Following the Test-First Programming approach, we write the tests for
      the <code class="literal">BankAccount</code> class before we write the code for
      the class itself. We use the contract conditions as the basis for the
      tests and name the test methods accordingly, as shown in
      <a class="xref" href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccountTest.php" title="Example 8.1: Tests for the BankAccount class">Example 8.1</a>.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccountTest.php"></a><p class="title"><strong>Example 8.1: Tests for the BankAccount class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';
require_once 'BankAccount.php';

class BankAccountTest extends PHPUnit2_Framework_TestCase {
    private $ba;

    protected function setUp() {
        $this-&gt;ba = new BankAccount;
    }

    public function testBalanceIsInitiallyZero() {
        $this-&gt;assertEquals(0, $this-&gt;ba-&gt;getBalance());
    }

    public function testBalanceCannotBecomeNegative() {
        try {
            $this-&gt;ba-&gt;withdrawMoney(1);
        }

        catch (Exception $e) {
            return;
        }

        $this-&gt;fail();
    }

    public function testBalanceCannotBecomeNegative2() {
        try {
            $this-&gt;ba-&gt;depositMoney(-1);
        }

        catch (Exception $e) {
            return;
        }

        $this-&gt;fail();
    }

    public function testBalanceCannotBecomeNegative3() {
        try {
            $this-&gt;ba-&gt;setBalance(-1);
        }

        catch (Exception $e) {
            return;
        }

        $this-&gt;fail();
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      We now write the minimal amount of code needed for the first test,
      <code class="literal">testBalanceIsInitiallyZero()</code>, to pass. In our
      example this amounts to implementing the <code class="literal">getBalance()</code>
      method of the <code class="literal">BankAccount</code> class, as shown in
      <a class="xref" href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount.php" title="Example 8.2: Code needed for the testBalanceIsInitiallyZero() test to pass">Example 8.2</a>.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount.php"></a><p class="title"><strong>Example 8.2: Code needed for the testBalanceIsInitiallyZero() test to pass</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
class BankAccount {
    private $balance = 0;

    public function getBalance() {
        return $this-&gt;balance;
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      The test for the first contract condition now passes, but the tests for
      the second contract condition fail because we have yet to implement the
      methods that these tests call.
    </p><pre class="screen"><strong class="userinput"><code>phpunit BankAccountTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

.
Fatal error: Call to undefined method BankAccount::withdrawMoney()</pre><p>
      For the tests that ensure the second contract condition to pass, we now
      need to implement the <code class="literal">withdrawMoney()</code>,
      <code class="literal">depositMoney()</code>, and <code class="literal">setBalance()</code>
      methods, as shown in
      <a class="xref" href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount2.php" title="Example 8.3: The complete BankAccount class">Example 8.3</a>.
      These methods are written in a such a way that they raise an
      <code class="literal">InvalidArgumentException</code> when they are called with
      illegal values that would violate the contract conditions.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount2.php"></a><p class="title"><strong>Example 8.3: The complete BankAccount class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
class BankAccount {
    private $balance = 0;

    public function getBalance() {
        return $this-&gt;balance;
    }

    public function setBalance($balance) {
        if ($balance &gt;= 0) {
            $this-&gt;balance = $balance;
        } else {
            throw new InvalidArgumentException;
        }
    }

    public function depositMoney($amount) {
        if ($amount &gt;= 0) {
            $this-&gt;balance += $amount;
        } else {
            throw new InvalidArgumentException;
        }
    }

    public function withdrawMoney($amount) {
        if ($amount &gt;= 0 &amp;&amp; $this-&gt;balance &gt;= $amount) {
            $this-&gt;balance -= $amount;
        } else {
            throw new InvalidArgumentException;
        }
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      The tests that ensure the second contract condition now pass, too:
    </p><pre class="screen"><strong class="userinput"><code>phpunit BankAccountTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

....

Time: 0.057038

OK (4 tests)</pre><p>
      <a id="idm140250594719536" class="indexterm"></a>

      Alternatively, you can use the static assertion methods provided by the
      <code class="literal">PHPUnit2_Framework_Assert</code> class to write the contract
      conditions as design-by-contract style assertions into your code, as
      shown in <a class="xref" href="test-first-programming.html#test-first-programming.bankaccount-example.examples.BankAccount3.php" title="Example 8.4: The BankAccount class with Design-by-Contract assertions">Example 8.4</a>.
      When one of these assertions fails, an
      <code class="literal">PHPUnit2_Framework_AssertionFailedError</code> exception
      will be raised. With this approach, you write less code for the contract
      condition checks and the tests become more readable. However, you add a
      runtime dependency on PHPUnit to your project.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount3.php"></a><p class="title"><strong>Example 8.4: The BankAccount class with Design-by-Contract assertions</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/Assert.php';

class BankAccount {
    private $balance = 0;

    public function getBalance() {
        return $this-&gt;balance;
    }

    public function setBalance($balance) {
        PHPUnit2_Framework_Assert::assertTrue($balance &gt;= 0);

        $this-&gt;balance = $balance;
    }

    public function depositMoney($amount) {
        PHPUnit2_Framework_Assert::assertTrue($amount &gt;= 0);

        $this-&gt;balance += $amount;
    }

    public function withdrawMoney($amount) {
        PHPUnit2_Framework_Assert::assertTrue($amount &gt;= 0);
        PHPUnit2_Framework_Assert::assertTrue($this-&gt;balance &gt;= $amount);

        $this-&gt;balance -= $amount;
    }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      By writing the contract conditions into the tests, we have used
      Design-by-Contract to program the <code class="literal">BankAccount</code> class.
      We then wrote, following the Test-First Programming approach, the
      code needed to make the tests pass. However, we forgot to write
      tests that call <code class="literal">setBalance()</code>,
      <code class="literal">depositMoney()</code>, and <code class="literal">withdrawMoney()</code>
      with legal values that do not violate the contract conditions.
      We need a means to test our tests or at least to measure their quality.
      Such a means is the analysis of code-coverage information that we will
      discuss next.
    </p></div></div>
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="incomplete-tests.html">Prev</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="code-coverage-analysis.html">Next</a></div>
     </div>
    </div>
   </div>
   <hr/>
   <footer>
    <p><a href="appendixes.copyright.html">Copyright</a> &copy; 2005-2017 <a href="http://sebastian-bergmann.de/">Sebastian Bergmann</a>.</p>
   </footer>
  </div>
  <script src="js/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/highlight.pack.js"></script>
  <script type="text/javascript">
  $(document).ready(function() { $('pre.programlisting').each(function(i, e) {hljs.highlightBlock(e)}); });
  </script>
 </body>
</html>
