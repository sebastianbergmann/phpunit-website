<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>PHPUnit Pocket Guide</title><link rel="stylesheet" type="text/css" href="css/docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /></head><body><div xml:lang="en" class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="phpunit"></a>PHPUnit Pocket Guide</h1></div><div><h2 class="subtitle">Quick Lookup and Advice</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Sebastian</span> <span class="surname">Bergmann</span></h3></div></div><div><p class="copyright">Copyright © 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015 Sebastian Bergmann</p></div><div><div class="legalnotice"><a id="idm140466938237984"></a><p>This work is licensed under the Creative Commons Attribution License. To view a copy of this license, visit <code class="systemitem">http://creativecommons.org/licenses/by/2.0/</code> or send a letter to Creative Commons, 559 Nathan Abbott Way, Stanford, California 94305, USA.</p></div></div><div><p class="pubdate">Edition for PHPUnit 2.3. Updated on 2018-04-12.</p></div></div><hr /></div><div class="toc"><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#preface.requirements">Requirements</a></span></dt><dt><span class="section"><a href="#preface.license">This Book Is Free</a></span></dt><dt><span class="section"><a href="#preface.conventions">Conventions Used in This Book</a></span></dt><dt><span class="section"><a href="#preface.acknowledgements">Acknowledgements</a></span></dt></dl></dd><dt><span class="chapter"><a href="#automating-tests">1. Automating Tests</a></span></dt><dt><span class="chapter"><a href="#goals">2. PHPUnit's Goals</a></span></dt><dt><span class="chapter"><a href="#installation">3. Installing PHPUnit</a></span></dt><dt><span class="chapter"><a href="#textui">4. The Command-Line Test Runner</a></span></dt><dt><span class="chapter"><a href="#fixtures">5. Fixtures</a></span></dt><dd><dl><dt><span class="section"><a href="#fixtures.more-setup-than-teardown">More setUp() than tearDown()</a></span></dt><dt><span class="section"><a href="#fixtures.variations">Variations</a></span></dt><dt><span class="section"><a href="#fixtures.suite-level-setup">Suite-Level Setup</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testing-exceptions-and-performance-regressions">6. Testing Exceptions and Performance Regressions</a></span></dt><dd><dl><dt><span class="section"><a href="#testing-exceptions-and-performance-regressions.exceptions">Exceptions</a></span></dt><dt><span class="section"><a href="#testing-exceptions-and-performance-regressions.performance-regressions">Performance Regressions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#incomplete-tests">7. Incomplete Tests</a></span></dt><dt><span class="chapter"><a href="#test-first-programming">8. Test-First Programming</a></span></dt><dd><dl><dt><span class="section"><a href="#test-first-programming.bankaccount-example">BankAccount Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="#code-coverage-analysis">9. Code-Coverage Analysis</a></span></dt><dt><span class="chapter"><a href="#stubs">10. Stubs</a></span></dt><dd><dl><dt><span class="section"><a href="#stubs.self-shunting">Self-Shunting</a></span></dt></dl></dd><dt><span class="chapter"><a href="#other-uses-for-tests">11. Other Uses for Tests</a></span></dt><dd><dl><dt><span class="section"><a href="#other-uses-for-tests.agile-documentation">Agile Documentation</a></span></dt><dt><span class="section"><a href="#other-uses-for-tests.cross-team-tests">Cross-Team Tests</a></span></dt><dt><span class="section"><a href="#other-uses-for-tests.debugging-tests">Debugging Tests</a></span></dt><dt><span class="section"><a href="#other-uses-for-tests.refactoring">Refactoring</a></span></dt></dl></dd><dt><span class="chapter"><a href="#phing">12. PHPUnit and Phing</a></span></dt><dd><dl><dt><span class="section"><a href="#phing.formatting-feedback">Formatting Feedback</a></span></dt></dl></dd><dt><span class="chapter"><a href="#implementation">13. PHPUnit's Implementation</a></span></dt><dt><span class="chapter"><a href="#api">14. PHPUnit API</a></span></dt><dd><dl><dt><span class="section"><a href="#api.overview">Overview</a></span></dt><dt><span class="section"><a href="#api.assert">PHPUnit2_Framework_Assert</a></span></dt><dt><span class="section"><a href="#api.test">PHPUnit2_Framework_Test</a></span></dt><dt><span class="section"><a href="#api.testcase">PHPUnit2_Framework_TestCase</a></span></dt><dt><span class="section"><a href="#api.testsuite">PHPUnit2_Framework_TestSuite</a></span></dt><dt><span class="section"><a href="#api.testresult">PHPUnit2_Framework_TestResult</a></span></dt><dt><span class="section"><a href="#api.package-structure">Package Structure</a></span></dt></dl></dd><dt><span class="chapter"><a href="#extending-phpunit">15. Extending PHPUnit</a></span></dt><dd><dl><dt><span class="section"><a href="#extending-phpunit.PHPUnit2_Framework_TestCase">Subclass PHPUnit2_Framework_TestCase</a></span></dt><dt><span class="section"><a href="#extending-phpunit.Assert">Assert Classes</a></span></dt><dt><span class="section"><a href="#extending-phpunit.PHPUnit2_Extensions_TestDecorator">Subclass PHPUnit2_Extensions_TestDecorator</a></span></dt><dt><span class="section"><a href="#extending-phpunit.PHPUnit2_Framework_Test">Implement PHPUnit2_Framework_Test</a></span></dt><dt><span class="section"><a href="#extending-phpunit.PHPUnit2_Framework_TestResult">Subclass PHPUnit2_Framework_TestResult</a></span></dt><dt><span class="section"><a href="#extending-phpunit.PHPUnit2_Framework_TestListener">Implement PHPUnit2_Framework_TestListener</a></span></dt><dt><span class="section"><a href="#extending-phpunit.TestRunner">New Test Runner</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appendixes.phpunit1">A. PHPUnit for PHP 4</a></span></dt><dt><span class="appendix"><a href="#appendixes.index">B. Index</a></span></dt><dd><dl><dt><span class="index"><a href="#appendixes.index.index"></a></span></dt></dl></dd><dt><span class="appendix"><a href="#appendixes.bibliography">C. Bibliography</a></span></dt><dt><span class="appendix"><a href="#appendixes.copyright">D. Copyright</a></span></dt></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a id="preface"></a>Preface</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    For a very long time my answer to the question "When will you write
    documentation for PHPUnit?" has been "You do not need documentation for
    PHPUnit. Just read the documentation for JUnit or a buy a book on JUnit
    and adapt the code examples from Java and JUnit to PHP and PHPUnit."
    When I mentioned this to Barbara Weiss and Alexandra Follenius from the
    O'Reilly Germany office, they encouraged me to think it over and
    write a book that would serve as the documentation for PHPUnit.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="preface.requirements"></a>Requirements</h2></div></div></div><p>
      The topic of this book is PHPUnit, an open source framework for test-driven
      development with the PHP programming language. This edition covers Version
      2.3 of PHPUnit. Most of the examples should work, however, with PHPUnit
      versions 2.0-2.2. The "PHPUnit for PHP 4" section, later in this book,
      covers the older, no longer actively developed version of PHPUnit for
      PHP 4.
    </p><p>
      The reader should have a good understanding of object-oriented
      programming with PHP 5. To German readers I can recommend my own book on
      PHP 5, <a class="xref" href="#Bergmann2005" title="Professionelle Softwareentwicklung mit PHP 5">[<abbr class="abbrev">Bergmann2005</abbr>]</a>, as an introduction to
      object-oriented programming with PHP 5. A good English book on the subject
      is <a class="xref" href="#GuBaRe2005" title="PHP 5 Power Programming">[<abbr class="abbrev">GuBaRe2005</abbr>]</a> by Andi Gutmans, Stig Bakken, and Derick
      Rethans.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="preface.license"></a>This Book Is Free</h2></div></div></div><p>
      This book is available under the Creative Commons Attribution License. You
      will always find the latest version of this book on its website at
      <code class="uri">http://www.phpunit.de/pocket_guide/</code>.
      You may distribute and make changes to this book however you wish. Of
      course, rather than distribute your own private version of the book,
      I would prefer you send feedback and patches to
      <code class="email">&lt;<a class="email" href="mailto:sb@sebastian-bergmann.de">sb@sebastian-bergmann.de</a>&gt;</code>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="preface.conventions"></a>Conventions Used in This Book</h2></div></div></div><p>
      The following is a list of typographical conventions used in this book:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>Italic</em></span></span></dt><dd><p>
            Indicates new terms, URLs, email addresses, filenames, file
            extensions, pathnames, directories, and Unix utilities.
          </p></dd><dt><span class="term"><code class="literal">Constant width</code></span></dt><dd><p>
            Indicates commands, options, switches, variables, functions,
            classes, namespaces, methods, modules, parameters, values,
            objects, the contents of files, or the output from commands.
          </p></dd><dt><span class="term"><strong class="userinput"><code>Constant width bold</code></strong></span></dt><dd><p>
            Shows commands or other text that should be typed literally
            by the user.
          </p></dd><dt><span class="term"><em class="replaceable"><code>Constant width italic</code></em></span></dt><dd><p>
            Shows text that should be replaced with user-supplied values.
          </p></dd></dl></div><p>
      You should pay special attention to notes set apart from the text
      with the following styles:
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        This is a tip, suggestion, or general note. It contains useful
        supplementary information about the topic at hand.
      </p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
        This is a warning or note of caution.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="preface.acknowledgements"></a>Acknowledgements</h2></div></div></div><p>
      I would like to thank Kent Beck and Erich Gamma for JUnit and the
      inspiration to write PHPUnit. I would also like to thank Kent Beck for
      his "JUnit Pocket Guide" <a class="xref" href="#Beck2004" title="JUnit Pocket Guide">[<abbr class="abbrev">Beck2004</abbr>]</a>, which sparked the
      idea for this book. I would like to thank Allison Randal, Alexandra
      Follenius, and Barbara Weiss for sponsoring this book at O'Reilly.
    </p><p>
      I would like to thank Andi Gutmans, Zeev Suraski, and Marcus Börger
      for their work on the Zend Engine 2, the core of PHP 5. I would like to
      thank Derick Rethans for Xdebug, the PHP extension that makes PHPUnit's
      Code Coverage functionality possible. Finally, I would like to thank
      Michiel Rook, who wrote the PHPUnit tasks for Phing.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="automating-tests"></a>Chapter 1. Automating Tests</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    Even good programmers make mistakes. The difference between a good
    programmer and a bad programmer is that the good programmer uses tests
    to detect mistakes as soon as possible. The sooner you test for a
    mistake the greater your chance of finding it and the less it will cost
    to find and fix. This explains why leaving testing until just before
    releasing software is so problematic. Most errors do not get caught at
    all, and the cost of fixing the ones you do catch is so high that you
    have to perform triage with the errors because you just cannot afford
    to fix them all.
  </p><p>
    <a id="idm140466933562256" class="indexterm"></a>

    Testing with PHPUnit is not a totally different activity from what you
    should already be doing. It is just a different way of doing it. The
    difference is between <span class="emphasis"><em>testing</em></span>, that is, checking
    that your program behaves as expected, and <span class="emphasis"><em>performing a battery
    of tests</em></span>, runnable code-fragments that automatically test the
    correctness of parts (units) of the software. These runnable
    code-fragments are called unit tests.
  </p><p>
    In this chapter we will go from simple <code class="literal">print</code>-based
    testing code to a fully automated test. Imagine that we have been asked
    to test PHP's built-in <code class="literal">array</code>. One bit of functionality
    to test is the function <code class="literal">sizeof()</code>. For a newly created
    array we expect the <code class="literal">sizeof()</code> function to return
    <code class="literal">0</code>. After we add an element, <code class="literal">sizeof()</code>
    should return <code class="literal">1</code>.
    <a class="xref" href="#automating-tests.examples.array-test.php" title="Example 1.1: Testing Array and sizeof()">Example 1.1</a> shows what
    we want to test.
  </p><div class="example"><a id="automating-tests.examples.array-test.php"></a><p class="title"><strong>Example 1.1: Testing Array and sizeof()</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
$fixture = array();
// $fixture is expected to be empty.

$fixture[] = 'element';
// $fixture is expected to contain one element.
?&gt;</pre></div></div><br class="example-break" /><p>
    A really simple way to check whether we are getting the results we
    expect is to print the result of <code class="literal">sizeof()</code> before
    and after adding the element (see
    <a class="xref" href="#automating-tests.examples.array-test2.php" title="Example 1.2: Using print to test Array and sizeof()">Example 1.2</a>).
    If we get <code class="literal">0</code> and then <code class="literal">1</code>,
    <code class="literal">array</code> and <code class="literal">sizeof()</code> behave as
    expected.
  </p><div class="example"><a id="automating-tests.examples.array-test2.php"></a><p class="title"><strong>Example 1.2: Using print to test Array and sizeof()</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
$fixture = array();
print sizeof($fixture) . "\n";

$fixture[] = "element";
print sizeof($fixture) . "\n";
?&gt;</pre><pre class="screen">0
1</pre></div></div><br class="example-break" /><p>
    Now, we would like to move from tests that require manual interpretation
    to tests that can run automatically. In
    <a class="xref" href="#automating-tests.examples.array-test3.php" title="Example 1.3: Comparing expected and actual values to test Array and sizeof()">Example 1.3</a>, we write
    the comparison of the expected and actual values into the test code and
    print <code class="literal">ok</code> if the values are equal. If we ever see a
    <code class="literal">not ok</code> message, we know something is wrong.
  </p><div class="example"><a id="automating-tests.examples.array-test3.php"></a><p class="title"><strong>Example 1.3: Comparing expected and actual values to test Array and sizeof()</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
$fixture = array();
print sizeof($fixture) == 0 ? "ok\n" : "not ok\n";

$fixture[] = 'element';
print sizeof($fixture) == 1 ? "ok\n" : "not ok\n";
?&gt;</pre><pre class="screen">ok
ok</pre></div></div><br class="example-break" /><p>
    <a id="idm140466933454000" class="indexterm"></a>

    We now factor out the comparison of expected and actual values into a
    function that raises an Exception when there is a discrepancy
    (<a class="xref" href="#automating-tests.examples.array-test4.php" title="Example 1.4: Using an assertion function to test Array and sizeof()">Example 1.4</a>). This
    gives us two benefits: the writing of tests becomes easier and we only
    get output when something is wrong.
  </p><div class="example"><a id="automating-tests.examples.array-test4.php"></a><p class="title"><strong>Example 1.4: Using an assertion function to test Array and sizeof()</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
$fixture = array();
assertTrue(sizeof($fixture) == 0);

$fixture[] = 'element';
assertTrue(sizeof($fixture) == 1);

function assertTrue($condition)
{
    if (!$condition) {
        throw new Exception('Assertion failed.');
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    <a id="idm140466933450384" class="indexterm"></a>

    The test is now completely automated. Instead of just
    <span class="emphasis"><em>testing</em></span> as we did with our first version,
    with this version we have an <span class="emphasis"><em>automated test</em></span>.
  </p><p>
    The goal of using automated tests is to make fewer mistakes. While your
    code will still not be perfect, even with excellent tests, you will
    likely see a dramatic reduction in defects once you start automating
    tests. Automated tests give you justified confidence in your code. You
    can use this confidence to take more daring leaps in design
    (Refactoring), get along with your teammates better (Cross-Team Tests),
    improve relations with your customers, and go home every night with
    proof that the system is better now than it was this morning because of
    your efforts.
  </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="goals"></a>Chapter 2. PHPUnit's Goals</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    So far, we only have two tests for the <code class="literal">array</code> built-in
    and the <code class="literal">sizeof()</code> function. When we start to test the
    numerous <code class="literal">array_*()</code> functions PHP offers, we will need
    to write a test for each of them. We could write the infrastructure for
    all these tests from scratch. However, it is much better to write a
    testing infrastructure once and then write only the unique parts of each
    test. PHPUnit is such an infrastructure.
  </p><p>
    <a class="xref" href="#goals.examples.ArrayTest.php" title="Example 2.1: Testing Array and sizeof() with PHPUnit">Example 2.1</a> shows how we have to
    rewrite our two tests from
    <a class="xref" href="#automating-tests.examples.array-test4.php" title="Example 1.4: Using an assertion function to test Array and sizeof()">Example 1.4</a> so that we
    can use them with PHPUnit.
  </p><div class="example"><a id="goals.examples.ArrayTest.php"></a><p class="title"><strong>Example 2.1: Testing Array and sizeof() with PHPUnit</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';

class ArrayTest extends PHPUnit2_Framework_TestCase {
    public function testNewArrayIsEmpty() {
        // Create the Array fixture.
        $fixture = array();

        // Assert that the size of the Array fixture is 0.
        $this-&gt;assertEquals(0, sizeof($fixture));
    }

    public function testArrayContainsAnElement() {
        // Create the Array fixture.
        $fixture = array();

        // Add an element to the Array fixture.
        $fixture[] = 'Element';

        // Assert that the size of the Array fixture is 1.
        $this-&gt;assertEquals(1, sizeof($fixture));
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    <a id="idm140466933399968" class="indexterm"></a>

    <a class="xref" href="#goals.examples.ArrayTest.php" title="Example 2.1: Testing Array and sizeof() with PHPUnit">Example 2.1</a> shows the basic steps
    for writing tests with PHPUnit:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The tests for a class <code class="literal">Class</code> go into a class <code class="literal">ClassTest</code>.</p></li><li class="listitem"><p><code class="literal">ClassTest</code> inherits (most of the time) from <code class="literal">PHPUnit2_Framework_TestCase</code>.</p></li><li class="listitem"><p>The tests are public methods that expect no parameters and are named <code class="literal">test*</code>.</p></li><li class="listitem"><p>Inside the test methods, assertion methods such as <code class="literal">assertEquals()</code> (see <a class="xref" href="#api.assert.tables.assertions" title="Table 14.1. Assertions">Table 14.1</a>) are used to assert that an actual value matches an expected value.</p></li></ol></div><p>
    A framework such as PHPUnit has to resolve a set of constraints, some of
    which seem always to conflict with each other. Simultaneously, tests
    should be:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>Easy to learn to write.</em></span></span></dt><dd><p>
          If it's hard to learn how to write tests, developers will not learn
          to write them.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Easy to write.</em></span></span></dt><dd><p>
          If tests are not easy to write, developers will not write them.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Easy to read.</em></span></span></dt><dd><p>
          Test code should contain no extraneous overhead so that the test
          itself does not get lost in noise that surrounds it.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Easy to execute.</em></span></span></dt><dd><p>
          The tests should run at the touch of a button and present their
          results in a clear and unambiguous format.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Quick to execute.</em></span></span></dt><dd><p>
          Tests should run fast so so they can be run hundreds or thousands
          of times a day.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Isolated.</em></span></span></dt><dd><p>
          The tests should not affect each other. If the order in which the
          tests are run changes, the results of the tests should not change.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Composable.</em></span></span></dt><dd><p>
          We should be able to run any number or combination of tests together.
          This is a corollary of isolation.
        </p></dd></dl></div><p>
    There are two main clashes between these constraints:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>Easy to learn to write versus easy to write.</em></span></span></dt><dd><p>
          Tests do not generally require all the flexibility of a programming
          language. Many testing tools provide their own scripting language
          that only includes the minimum necessary features for writing tests.
          The resulting tests are easy to read and write because they have no
          noise to distract you from the content of the tests. However,
          learning yet another programming language and set of programming
          tools is inconvenient and clutters the mind.
        </p></dd><dt><span class="term"><span class="emphasis"><em>Isolated versus quick to execute.</em></span></span></dt><dd><p>
          If you want the results of one test to have no effect on the results
          of another test, each test should create the full state of the world
          before it begins to execute and return the world to its original
          state when it finishes. However, setting up the world can take a
          long time: for example connecting to a database and initializing it
          to a known state using realistic data.
        </p></dd></dl></div><p>
    PHPUnit attempts to resolve these conflicts by using PHP as the testing
    language. Sometimes the full power of PHP is overkill for writing little
    straight-line tests, but by using PHP we leverage all the experience and
    tools programmers already have in place. Since we are trying to convince
    reluctant testers, lowering the barrier to writing those initial tests
    is particularly important.
  </p><p>
    PHPUnit errs on the side of isolation over quick execution. Isolated
    tests are valuable because they provide high-quality feedback. You do
    not get a report with a bunch of test failures, which were really caused
    because one test at the beginning of the suite failed and left the world
    messed up for the rest of the tests. This orientation towards isolated
    tests encourages designs with a large number of simple objects. Each
    object can be tested quickly in isolation. The result is better designs
    <span class="emphasis"><em>and</em></span> faster tests.
  </p><p>
    PHPUnit assumes that most tests succeed and it is not worth reporting
    the details of successful tests. When a test fails, that fact is worth
    noting and reporting. The vast majority of tests should succeed and are
    not worth commenting on except to count the number of tests that run.
    This is an assumption that is really built into the reporting classes,
    and not into the core of PHPUnit. When the results of a test run are
    reported, you see how many tests were executed, but you only see details
    for those that failed.
  </p><p>
    Tests are expected to be fine-grained, testing one aspect of one object.
    Hence, the first time a test fails, execution of the test halts, and
    PHPUnit reports the failure. It is an art to test by running in many
    small tests. Fine-grained tests improve the overall design of the system.
  </p><p>
    When you test an object with PHPUnit, you do so only through the
    object's public interface. Testing based only on publicly visible
    behaviour encourages you to confront and solve difficult design problems
    earlier, before the results of poor design can infect large parts of the
    system.
  </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="installation"></a>Chapter 3. Installing PHPUnit</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    <a class="ulink" href="http://www.phpunit.de/" target="_top">PHPUnit</a> should be installed
    using the <a class="ulink" href="http://pear.php.net/" target="_top">PEAR Installer</a>. This
    installer is the backbone of PEAR, which provides a distribution system
    for PHP packages, and is shipped with every release of PHP since version
    4.3.0.
  </p><p>
    The PEAR channel (<code class="literal">pear.phpunit.de</code>) that is used to
    distribute PHPUnit needs to be registered with the local PEAR environment:
  </p><pre class="screen"><strong class="userinput"><code>pear channel-discover pear.phpunit.de</code></strong></pre><p>
    This has to be done only once. Now the PEAR Installer can be used to
    install packages from the PHPUnit channel:
  </p><pre class="screen"><strong class="userinput"><code>pear install phpunit/PHPUnit</code></strong></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      Previous installations of the <code class="literal">PHPUnit</code> and
      <code class="literal">PHPUnit2</code> packages from the <code class="literal">pear.php.net</code>
      channel have to be uninstalled.
    </p></div><p>
    After the installation you can find the PHPUnit source files inside your
    local PEAR directory; the path is usually
    <code class="filename">/usr/lib/php/PHPUnit</code>.
  </p><p>
    Although using the PEAR Installer is the only supported way to install
    PHPUnit, you can install PHPUnit manually. For manual installation, do
    the following:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        Download a release archive from
        <code class="literal">http://pear.phpunit.de/get/</code>
        and extract it to a directory that is listed in the
        <code class="literal">include_path</code> of your <code class="filename">php.ini</code>
        configuration file.
      </p></li><li class="listitem"><p>
        Prepare the <code class="filename">phpunit</code> script:
      </p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>
            Rename the <code class="filename">pear-phpunit</code> script to
            <code class="filename">phpunit</code>.
          </p></li><li class="listitem"><p>
            Replace the <code class="literal">@php_bin@</code> string in it with the
            path to your PHP command-line interpreter (usually
            <code class="filename">/usr/bin/php</code>).
          </p></li><li class="listitem"><p>
            Copy it to a directory that is in your <code class="filename">PATH</code>
            and make it executable (<code class="literal">chmod +x phpunit</code>).
          </p></li></ol></div></li></ol></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="textui"></a>Chapter 4. The Command-Line Test Runner</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    The PHPUnit command-line test runner can be invoked through the
    <code class="filename">phpunit</code> command. The following code shows how to run
    tests with the PHPUnit command-line test runner:
  </p><pre class="screen"><strong class="userinput"><code>phpunit ArrayTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

..

Time: 0.067288

OK (2 tests)</pre><p>
    For each test run, the PHPUnit command-line tool prints one character to
    indicate progress:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">.</code></span></dt><dd><p>
          Printed when the test succeeds.
        </p></dd><dt><span class="term"><code class="literal">F</code></span></dt><dd><p>
          Printed when an assertion fails while running the test method.
        </p></dd><dt><span class="term"><code class="literal">E</code></span></dt><dd><p>
          Printed when an error occurs while running the test method.
        </p></dd><dt><span class="term"><code class="literal">I</code></span></dt><dd><p>
          Printed when the test is marked as being incomplete or not yet
          implemented (see <a class="xref" href="#incomplete-tests" title="Chapter 7. Incomplete Tests">Chapter 7</a>).
        </p></dd></dl></div><p>
    <a id="idm140466933252448" class="indexterm"></a>
    <a id="idm140466933251696" class="indexterm"></a>

    PHPUnit distinguishes between <span class="emphasis"><em>failures</em></span> and
    <span class="emphasis"><em>errors</em></span>. A failure is a violated PHPUnit
    assertion. An error is an unexpected exception or a PHP error. Sometimes
    this distinction proves useful since errors tend to be easier to fix
    than failures. If you have a big list of problems, it is best to
    tackle the errors first and see if you have any failures left when
    they are all fixed.
  </p><p>
    Let's take a look at the command-line test runner's switches in
    the following code:
  </p><pre class="screen"><strong class="userinput"><code>phpunit --help</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

Usage: phpunit [switches] UnitTest [UnitTest.php]
  --coverage-data &lt;file&gt; Write Code Coverage data in raw format to file.
  --coverage-html &lt;file&gt; Write Code Coverage data in HTML format to file.
  --coverage-text &lt;file&gt; Write Code Coverage data in text format to file.

  --testdox-html &lt;file&gt;  Write agile documentation in HTML format to file.
  --testdox-text &lt;file&gt;  Write agile documentation in Text format to file.
  --log-xml &lt;file&gt;       Log test progress in XML format to file.

  --loader &lt;loader&gt;      TestSuiteLoader implementation to use.

  --skeleton             Generate skeleton UnitTest class for Unit in Unit.php.

  --wait                 Waits for a keystroke after each test.

  --help                 Prints this usage information.
  --version              Prints the version and exits.</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">phpunit UnitTest</code></span></dt><dd><p>
          Runs the tests that are provided by the class
          <code class="literal">UnitTest</code>. This class is expected to be declared
          in the <code class="filename">UnitTest.php</code> sourcefile.
        </p><p>
          <code class="literal">UnitTest</code> must be either a class that inherits
          from <code class="literal">PHPUnit2_Framework_TestCase</code> or a class that
          provides a <code class="literal">public static suite()</code> method which
          returns an <code class="literal">PHPUnit2_Framework_Test</code> object, for
          example an instance of the
          <code class="literal">PHPUnit2_Framework_TestSuite</code> class.
        </p></dd><dt><span class="term"><code class="literal">phpunit UnitTest UnitTest.php</code></span></dt><dd><p>
          Runs the tests that are provided by the class
          <code class="literal">UnitTest</code>. This class is expected to be declared
          in the specified sourcefile.
        </p></dd><dt><span class="term"><code class="literal">--coverage-data</code>, <code class="literal">--coverage-html</code>, and <code class="literal">--coverage-text</code></span></dt><dd><p>
          Control the collection and analysis of Code Coverage information for
          the tests that are run.
          (See <a class="xref" href="#code-coverage-analysis" title="Chapter 9. Code-Coverage Analysis">Chapter 9</a>.)
        </p></dd><dt><span class="term"><code class="literal">--testdox-html</code> and <code class="literal">--testdox-text</code></span></dt><dd><p>
          Generates agile documentation in HTML or plain text format for the
          tests that are run. (See <a class="xref" href="#other-uses-for-tests" title="Chapter 11. Other Uses for Tests">Chapter 11</a>.)
        </p></dd><dt><span class="term"><code class="literal">--log-xml</code></span></dt><dd><p>
          Generates a logfile in XML format for the tests run.
        </p><p>
          The following example shows the XML logfile generated for the tests
          in <code class="literal">ArrayTest</code>:
        </p><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;testsuites&gt;
  &lt;testsuite name="ArrayTest" tests="2" failures="0" errors="0" time="0.020026"&gt;
    &lt;testcase name="testNewArrayIsEmpty" class="ArrayTest" time="0.014449"/&gt;
    &lt;testcase name="testArrayContainsAnElement" class="ArrayTest" time="0.005577"/&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;</pre><p>
          This XML logfile was generated for two tests,
          <code class="literal">testFailure</code> and <code class="literal">testError</code>,
          of a test-case class named <code class="literal">FailureErrorTest</code> and
          shows how failures and errors are denoted.
        </p><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;testsuites&gt;
  &lt;testsuite name="FailureErrorTest" tests="2" failures="1" errors="1" time="0.013603"&gt;
    &lt;testcase name="testFailure" class="FailureErrorTest" time="0.011872"&gt;
      &lt;failure message="" type="PHPUnit2_Framework_AssertionFailedError"&gt;&lt;/failure&gt;
    &lt;/testcase&gt;
    &lt;testcase name="testError" class="FailureErrorTest" time="0.001731"&gt;
      &lt;error message="" type="Exception"&gt;&lt;/error&gt;
    &lt;/testcase&gt;
  &lt;/testsuite&gt;
&lt;/testsuites&gt;
</pre></dd><dt><span class="term"><code class="literal">--loader</code></span></dt><dd><p>
          Specifies the <code class="literal">PHPUnit2_Runner_TestSuiteLoader</code>
          implementation to use.
        </p><p>
          The standard test suite loader will look for the sourcefile in the
          current working directory and in each directory that is specified in
          PHP's <code class="literal">include_path</code> configuration directive.
          Following the PEAR Naming Conventions, a class name such as
          <code class="literal">Project_Package_Class</code> is mapped to the
          sourcefile name <code class="filename">Project/Package/Class.php</code>.
        </p></dd><dt><span class="term"><code class="literal">--skeleton</code></span></dt><dd><p>
          Generates a skeleton test-case class <code class="literal">UnitTest</code>
          (in <code class="filename">UnitTest.php</code>) for a class
          <code class="literal">Unit</code> (in <code class="filename">Unit.php</code>).
          For each method in the original class, there will be an incomplete
          test-case (see <a class="xref" href="#incomplete-tests" title="Chapter 7. Incomplete Tests">Chapter 7</a>) in the generated
          test-case class.
        </p><p>
          The following example shows how to generate a a skeleton test class
          for a class named <code class="literal">Sample</code>.
        </p><pre class="screen"><strong class="userinput"><code>phpunit --skeleton Sample</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

Wrote test class skeleton for Sample to SampleTest.php.

<strong class="userinput"><code>phpunit SampleTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

I

Time: 0.007268
There was 1 incomplete test case:
1) testSampleMethod(SampleTest)


OK, but incomplete test cases!!!
Tests run: 1, incomplete test cases: 1.</pre><p>
          When you are writing tests for existing code, you have to write the
          same code fragments as in the following example: </p><pre class="programlisting">public function testSampleMethod() {
}</pre><p> over and over again. PHPUnit can help you by analyzing the
          existing code and generating a skeleton test-case class for it.
        </p></dd><dt><span class="term"><code class="literal">--wait</code></span></dt><dd><p>
          Waits for a keystroke after each test. This is useful if you are
          running the tests in a window that stays open only as long as the
          test runner is active.
        </p></dd></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      When the tested code contains PHP syntax errors the TextUI test runner
      might exit without printing error information. The standard test suite
      loader will check the test suite sourcefile for PHP syntax errors, but
      not sourcefiles included by the test suite sourcefile. Future versions
      of PHPUnit will solve this issue by using a sandboxed PHP interpreter.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="fixtures"></a>Chapter 5. Fixtures</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    <a id="idm140466933183392" class="indexterm"></a>

    One of the most time-consuming parts of writing tests is writing the
    code to set the world up in a known state and then return it to its
    original state when the test is complete. This known state is called
    the <span class="emphasis"><em>fixture</em></span> of the test.
  </p><p>
    In <a class="xref" href="#goals.examples.ArrayTest.php" title="Example 2.1: Testing Array and sizeof() with PHPUnit">Example 2.1</a>, the fixture
    was simply the array that is stored in the <code class="literal">$fixture</code>
    variable. Most of the time, though, the fixture will be more complex
    than a simple array, and the amount of code needed to set it up will
    grow accordingly. The actual content of the test gets lost in the noise
    of setting up the fixture. This problem gets even worse when you write
    several tests with similar fixtures. Without some help from the testing
    framework, we would have to duplicate the code that sets up the fixture
    for each test we write.
  </p><p>
    <a id="idm140466933120736" class="indexterm"></a>
    <a id="idm140466933119984" class="indexterm"></a>
    <a id="idm140466933119232" class="indexterm"></a>

    PHPUnit supports sharing the setup code. Before a test method is run, a
    template method called <code class="literal">setUp()</code> is invoked.
    <code class="literal">setUp()</code> is where you create the objects against which
    you will test. Once the test method has finished running, whether it
    succeeded or failed, another template method called
    <code class="literal">tearDown()</code> is invoked. <code class="literal">tearDown()</code>
    is where you clean up the objects against which you tested.
  </p><p>
    We can now refactor <a class="xref" href="#goals.examples.ArrayTest.php" title="Example 2.1: Testing Array and sizeof() with PHPUnit">Example 2.1</a> and
    use <code class="literal">setUp()</code> to eliminate the code duplication that
    we had before. First we declare the instance variable,
    <code class="literal">$fixture</code>, that we are going to use instead of a
    method-local variable. Then we put the creation of the
    <code class="literal">array</code> fixture into the <code class="literal">setUp()</code>
    method. Finally, we remove the redundant code from the test methods and
    use the newly introduced instance variable,
    <code class="literal">$this-&gt;fixture</code>, instead of the method-local variable
    <code class="literal">$fixture</code> with the <code class="literal">assertEquals()</code>
    assertion method.
  </p><div class="example"><a id="fixtures.examples.ArrayTest.php"></a><p class="title"><strong>Example 5.1: Using setUp() to create the Array fixture</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';

class ArrayTest extends PHPUnit2_Framework_TestCase {
    protected $fixture;

    protected function setUp() {
        // Create the Array fixture.
        $this-&gt;fixture = array();
    }

    public function testNewArrayIsEmpty() {
        // Assert that the size of the Array fixture is 0.
        $this-&gt;assertEquals(0, sizeof($this-&gt;fixture));
    }

    public function testArrayContainsAnElement() {
        // Add an element to the Array fixture.
        $this-&gt;fixture[] = 'Element';

        // Assert that the size of the Array fixture is 1.
        $this-&gt;assertEquals(1, sizeof($this-&gt;fixture));
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    <code class="literal">setUp()</code> and <code class="literal">tearDown()</code> will be
    called once for each test method run. While it might seem frugal to
    only run these methods once for all the test methods in a test-case
    class, doing so would make it hard to write tests that are completely
    independent of each other.
  </p><p>
    Not only are <code class="literal">setUp()</code> and <code class="literal">tearDown()</code>
    run once for each test method, but the test methods are run in fresh
    instances of the test-case class (see <a class="xref" href="#implementation" title="Chapter 13. PHPUnit's Implementation">Chapter 13</a>).
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="fixtures.more-setup-than-teardown"></a>More setUp() than tearDown()</h2></div></div></div><p>
      <code class="literal">setUp()</code> and <code class="literal">tearDown()</code> are nicely
      symmetrical in theory but not in practice. In practice, you only need
      to implement <code class="literal">tearDown()</code> if you have allocated
      external resources like files or sockets in <code class="literal">setUp()</code>.
      If your <code class="literal">setUp()</code> just creates plain PHP objects, you
      can generally ignore <code class="literal">tearDown()</code>. However, if you
      create many objects in your <code class="literal">setUp()</code>, you might want
      to <code class="literal">unset()</code> the variables pointing to those objects
      in your <code class="literal">tearDown()</code> so they can be garbage collected.
      The garbage collection of test case objects is not predictable.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="fixtures.variations"></a>Variations</h2></div></div></div><p>
      What happens when you have two tests with slightly different setups?
      There are two possibilities:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If the <code class="literal">setUp()</code> code differs only slightly, move
          the code that differs from the <code class="literal">setUp()</code> code to
          the test method.
        </p></li><li class="listitem"><p>
          If you really have a different <code class="literal">setUp()</code>, you need
          a different test-case class. Name the class after the difference in
          the setup.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="fixtures.suite-level-setup"></a>Suite-Level Setup</h2></div></div></div><p>
      <a id="idm140466933089424" class="indexterm"></a>

      PHPUnit does not provide convenient support for suite-level setup. There
      are few good reasons to share fixtures between tests, but in most cases
      the need to share a fixture between tests stems from an unresolved
      design problem.
    </p><p>
      A good example of a fixture that makes sense to share across several
      tests is a database connection: you log into the database once and reuse
      the database connection instead of creating a new connection for each
      test. This makes your tests run faster. To do this, write your database
      tests in a test-case class named <code class="literal">DatabaseTests</code> and
      wrap the test suite in a <code class="literal">TestSetup</code> decorator object
      that overrides <code class="literal">setUp()</code> to open the database
      connection and <code class="literal">tearDown()</code> to close the connection, as
      shown in
      <a class="xref" href="#fixtures.suite-level-setup.examples.DatabaseTestSetup.php" title="Example 5.2: Writing a suite-level setup decorator">Example 5.2</a>.
      You can run the tests from <code class="literal">DatabaseTests</code> through the
      <code class="literal">DatabaseTestSetup</code> decorator by invoking, for instance,
      PHPUnit's command-line test runner with
      <strong class="userinput"><code>phpunit DatabaseTestSetup</code></strong>.
    </p><div class="example"><a id="fixtures.suite-level-setup.examples.DatabaseTestSetup.php"></a><p class="title"><strong>Example 5.2: Writing a suite-level setup decorator</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestSuite.php';
require_once 'PHPUnit2/Extensions/TestSetup.php';

class DatabaseTestSetup extends PHPUnit2_Extensions_TestSetup {
    protected $connection = NULL;

    protected function setUp() {
        $this-&gt;connection = new PDO(
          'mysql:host=wopr;dbname=test',
          'root',
          ''
        );
    }

    protected function tearDown() {
        $this-&gt;connection = NULL;
    }

    public static function suite() {
        return new DatabaseTestSetup(
          new PHPUnit2_Framework_TestSuite('DatabaseTests')
        );
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      It cannot be emphasized enough that sharing fixtures between tests
      reduces the value of the tests. The underlying design problem is
      that objects are too closely bound together. You will achieve better
      results solving the underlying design problem and then writing tests
      using stubs (see <a class="xref" href="#stubs" title="Chapter 10. Stubs">Chapter 10</a>), than by creating
      dependencies between tests at runtime and ignoring the opportunity
      to improve your design.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="testing-exceptions-and-performance-regressions"></a>Chapter 6. Testing Exceptions and Performance Regressions</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    PHPUnit provides two extensions to the standard base-class for test
    classes, <code class="literal">PHPUnit2_Framework_TestCase</code>, that aid in the
    writing of tests for exceptions and performance regressions.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="testing-exceptions-and-performance-regressions.exceptions"></a>Exceptions</h2></div></div></div><p>
      How do you test exceptions? You cannot directly assert that they are
      raised. Instead you have to use PHP's exception handling facilities to
      write the test. The following example demonstrates testing exceptions:
    </p><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';

class ExceptionTest extends PHPUnit2_Framework_TestCase {
    public function testException() {
        try {
            // ... Code that is expected to raise an Exception ...
        }

        catch (Exception $expected) {
            return;
        }

        $this-&gt;fail('An expected Exception has not been raised.');
    }
}
?&gt;</pre><p>
      If the code that is expected to raise an exception does not raise an
      exception, the subsequent call to <code class="literal">fail()</code>
      (see <a class="xref" href="#api.assert.tables.bottleneck-methods" title="Table 14.2. Bottleneck Methods">Table 14.2</a>)
      will halt the test and signal a problem with the test. If the expected
      exception is raised, the <code class="literal">catch</code> block will be executed,
      and the test will end successfully.
    </p><p>
      <a id="idm140466933015872" class="indexterm"></a>

      Alternatively, you can extend your test class from
      <code class="literal">PHPUnit2_Extensions_ExceptionTestCase</code> to test whether
      an exception is thrown inside the tested code.
      <a class="xref" href="#testing-exceptions-and-performance-regressions.exceptions.examples.ExceptionTest2.php" title="Example 6.1: Using PHPUnit2_Extensions_ExceptionTestCase">Example 6.1</a>
      shows how to subclass <code class="literal">PHPUnit2_Extensions_ExceptionTestCase</code>
      and use its <code class="literal">setExpectedException()</code> method to set the
      expected exception. If this expected exception is not thrown, the test
      will be counted as a failure.
    </p><div class="example"><a id="testing-exceptions-and-performance-regressions.exceptions.examples.ExceptionTest2.php"></a><p class="title"><strong>Example 6.1: Using PHPUnit2_Extensions_ExceptionTestCase</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Extensions/ExceptionTestCase.php';

class ExceptionTest extends PHPUnit2_Extensions_ExceptionTestCase {
    public function testException() {
        $this-&gt;setExpectedException('Exception');
    }
}
?&gt;</pre><pre class="screen"><strong class="userinput"><code>phpunit ExceptionTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

F

Time: 0.006798
There was 1 failure:
1) testException(ExceptionTest)
Expected exception Exception

FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0, Incomplete Tests: 0.</pre></div></div><br class="example-break" /><p>
      <a class="xref" href="#testing-exceptions-and-performance-regressions.exceptions.tables.external-protocols" title="Table 6.1. ExceptionTestCase external protocols">Table 6.1</a>
      shows the external protocol implemented by
      <code class="literal">PHPUnit2_Extensions_ExceptionTestCase</code>.
    </p><div class="table"><a id="testing-exceptions-and-performance-regressions.exceptions.tables.external-protocols"></a><p class="title"><strong>Table 6.1. ExceptionTestCase external protocols</strong></p><div class="table-contents"><table class="table" summary="ExceptionTestCase external protocols" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void setExpectedException(string $exceptionName)</code></td><td align="left">Set the name of the expected exception to <code class="literal">$exceptionName</code>.</td></tr><tr><td align="left"><code class="literal">String getExpectedException()</code></td><td align="left">Return the name of the expected exception.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="testing-exceptions-and-performance-regressions.performance-regressions"></a>Performance Regressions</h2></div></div></div><p>
      <a id="idm140466932997792" class="indexterm"></a>

      You can extend your test class from <code class="literal">PHPUnit2_Extensions_PerformanceTestCase</code>
      to test whether the execution of a function or method call, for
      instance, exceeds a specified time limit.
    </p><p>
      <a class="xref" href="#testing-exceptions-and-performance-regressions.performance-regressions.examples.PerformanceTest.php" title="Example 6.2: Using PHPUnit2_Extensions_PerformanceTestCase">Example 6.2</a>
      shows how to subclass <code class="literal">PHPUnit2_Extensions_PerformanceTestCase</code>
      and use its <code class="literal">setMaxRunningTime()</code> method to set the
      maximum running time for the test. If the test is not executed within
      this time limit, it will be counted as a failure.
    </p><div class="example"><a id="testing-exceptions-and-performance-regressions.performance-regressions.examples.PerformanceTest.php"></a><p class="title"><strong>Example 6.2: Using PHPUnit2_Extensions_PerformanceTestCase</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Extensions/PerformanceTestCase.php';

class PerformanceTest extends PHPUnit2_Extensions_PerformanceTestCase {
    public function testPerformance() {
        $this-&gt;setMaxRunningTime(2);
        sleep(1);
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      <a class="xref" href="#testing-exceptions-and-performance-regressions.performance-regressions.tables.external-protocols" title="Table 6.2. PerformanceTestCase external protocols">Table 6.2</a>
      shows the external protocol implemented by
      <code class="literal">PHPUnit2_Extensions_PerformanceTestCase</code>.
    </p><div class="table"><a id="testing-exceptions-and-performance-regressions.performance-regressions.tables.external-protocols"></a><p class="title"><strong>Table 6.2. PerformanceTestCase external protocols</strong></p><div class="table-contents"><table class="table" summary="PerformanceTestCase external protocols" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void setMaxRunningTime(int $maxRunningTime)</code></td><td align="left">Set the maximum running time for the test to <code class="literal">$maxRunningTime</code> (in seconds).</td></tr><tr><td align="left"><code class="literal">integer getMaxRunningTime()</code></td><td align="left">Return the maximum running time allowed for the test.</td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="incomplete-tests"></a>Chapter 7. Incomplete Tests</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    When you are working on a new test-case class, you might want to begin
    by writing empty test methods such as: </p><pre class="programlisting">public function testSomething() {
}</pre><p> to keep track of the tests that you have to write. The
    problem with empty test methods is that they are interpreted as a
    success by the PHPUnit framework. This misinterpretation leads to the
    test reports being useless -- you cannot see whether a test is actually
    successful or just not yet implemented. Calling
    <code class="literal">$this-&gt;fail()</code> in the unimplemented test method
    does not help either, since then the test will be interpreted as a
    failure. This would be just as wrong as interpreting an unimplemented
    test as a success.
  </p><p>
    <a id="idm140466933025312" class="indexterm"></a>
    <a id="idm140466932932992" class="indexterm"></a>
    <a id="idm140466932932240" class="indexterm"></a>

    If we think of a successful test as a green light and a test failure
    as a red light, we need an additional yellow light to mark a test
    as being incomplete or not yet implemented.
    <code class="literal">PHPUnit2_Framework_IncompleteTest</code> is a marker
    interface for marking an exception that is raised by a test method as
    the result of the test being incomplete or currently not implemented.
    <code class="literal">PHPUnit2_Framework_IncompleteTestError</code> is the
    standard implementation of this interface.
  </p><p>
    <a class="xref" href="#incomplete-tests.examples.SampleTest.php" title="Example 7.1: Marking a test as incomplete">Example 7.1</a> shows a
    test-case class, <code class="literal">SampleTest</code>, that contains one test
    method, <code class="literal">testSomething()</code>. By raising the
    <code class="literal">PHPUnit2_Framework_IncompleteTestError</code> exception in
    the test method, we mark the test as being incomplete.
  </p><div class="example"><a id="incomplete-tests.examples.SampleTest.php"></a><p class="title"><strong>Example 7.1: Marking a test as incomplete</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';
require_once 'PHPUnit2/Framework/IncompleteTestError.php';

class SampleTest extends PHPUnit2_Framework_TestCase {
    public function testSomething() {
        // Optional: Test anything here, if you want.
        $this-&gt;assertTrue(TRUE, 'This should already work.');

        // Stop here and mark this test as incomplete.
        // You could use any Exception which implements the
        // PHPUnit2_Framework_IncompleteTest interface.
        throw new PHPUnit2_Framework_IncompleteTestError(
          'This test has not been implemented yet.'
        );
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    An incomplete test is denoted by an <code class="literal">I</code> in the output
    of the PHPUnit command-line test runner, as shown in the following
    example:
  </p><pre class="screen"><strong class="userinput"><code>phpunit SampleTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

I

Time: 0.006657
There was 1 incomplete test case:
1) testSomething(SampleTest)
This test has not been implemented yet.

OK, but incomplete test cases!!!
Tests run: 1, incomplete test cases: 1.</pre></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="test-first-programming"></a>Chapter 8. Test-First Programming</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    <a id="idm140466932963568" class="indexterm"></a>
    <a id="idm140466932962752" class="indexterm"></a>
    <a id="idm140466932961936" class="indexterm"></a>
    <a id="idm140466932890016" class="indexterm"></a>
    <a id="idm140466932889264" class="indexterm"></a>

    Unit Tests are a vital part of several software development practices
    and processes such as Test-First Programming,
    <a class="ulink" href="http://en.wikipedia.org/wiki/Extreme_Programming" target="_top">Extreme Programming</a>,
    and <a class="ulink" href="http://en.wikipedia.org/wiki/Test-driven_development" target="_top">Test-Driven Development</a>.
    They also allow for <a class="ulink" href="http://en.wikipedia.org/wiki/Design_by_Contract" target="_top">Design-by-Contract</a>
    in programming languages that do not support this methodology with
    language constructs.
  </p><p>
    You can use PHPUnit to write tests once you are done programming.
    However, the sooner a test is written after an error has been introduced,
    the more valuable the test is. So instead of writing tests months after
    the code is "complete", we can write tests days or hours or minutes after
    the possible introduction of a defect. Why stop there? Why not write the
    tests a little before the possible introduction of a defect?
  </p><p>
    Test-First Programming, which is part of Extreme Programming and
    Test-Driven Development, builds upon this idea and takes it to the
    extreme. With today's computational power, we have the opportunity to
    run thousands of tests thousands of times per day. We can use the
    feedback from all of these tests to program in small steps, each of
    which carries with it the assurance of a new automated test in addition
    to all the tests that have come before. The tests are like pitons,
    assuring you that, no matter what happens, once you have made progress
    you can only fall so far.
  </p><p>
    When you first write the test it cannot possibly run, because you are
    calling on objects and methods that have not been programmed yet. This
    might feel strange at first, but after a while you will get used to it.
    Think of Test-First Programming as a pragmatic approach to following the
    object-oriented programming principle of programming to an interface
    instead of programming to an implementation: while you are writing the
    test you are thinking about the interface of the object you are
    testing -- what does this object look like from the outside. When you
    go to make the test really work, you are thinking about pure
    implementation. The interface is fixed by the failing test.
  </p><p>
    What follows is necessarily an abbreviated introduction to Test-First
    Programming. You can explore the topic further in other books, such as
    <span class="emphasis"><em>Test-Driven Development</em></span> <a class="xref" href="#Beck2002" title="Test Driven Development by Example">[<abbr class="abbrev">Beck2002</abbr>]</a>
    by Kent Beck or Dave Astels' <span class="emphasis"><em>A Practical Guide to Test-Driven
    Development</em></span> <a class="xref" href="#Astels2003" title="Test Driven Development">[<abbr class="abbrev">Astels2003</abbr>]</a>.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="test-first-programming.bankaccount-example"></a>BankAccount Example</h2></div></div></div><p>
      In this chapter, we will look at the example of a class that represents
      a bank account. The contract for the <code class="literal">BankAccount</code>
      class not only requires methods to get and set the bank account's
      balance, as well as methods to deposit and withdraw money. It also
      specifies the following two conditions that must be ensured:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The bank account's initial balance must be zero.</p></li><li class="listitem"><p>The bank account's balance cannot become negative.</p></li></ul></div><p>
      Following the Test-First Programming approach, we write the tests for
      the <code class="literal">BankAccount</code> class before we write the code for
      the class itself. We use the contract conditions as the basis for the
      tests and name the test methods accordingly, as shown in
      <a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccountTest.php" title="Example 8.1: Tests for the BankAccount class">Example 8.1</a>.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccountTest.php"></a><p class="title"><strong>Example 8.1: Tests for the BankAccount class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';
require_once 'BankAccount.php';

class BankAccountTest extends PHPUnit2_Framework_TestCase {
    private $ba;

    protected function setUp() {
        $this-&gt;ba = new BankAccount;
    }

    public function testBalanceIsInitiallyZero() {
        $this-&gt;assertEquals(0, $this-&gt;ba-&gt;getBalance());
    }

    public function testBalanceCannotBecomeNegative() {
        try {
            $this-&gt;ba-&gt;withdrawMoney(1);
        }

        catch (Exception $e) {
            return;
        }

        $this-&gt;fail();
    }

    public function testBalanceCannotBecomeNegative2() {
        try {
            $this-&gt;ba-&gt;depositMoney(-1);
        }

        catch (Exception $e) {
            return;
        }

        $this-&gt;fail();
    }

    public function testBalanceCannotBecomeNegative3() {
        try {
            $this-&gt;ba-&gt;setBalance(-1);
        }

        catch (Exception $e) {
            return;
        }

        $this-&gt;fail();
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      We now write the minimal amount of code needed for the first test,
      <code class="literal">testBalanceIsInitiallyZero()</code>, to pass. In our
      example this amounts to implementing the <code class="literal">getBalance()</code>
      method of the <code class="literal">BankAccount</code> class, as shown in
      <a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccount.php" title="Example 8.2: Code needed for the testBalanceIsInitiallyZero() test to pass">Example 8.2</a>.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount.php"></a><p class="title"><strong>Example 8.2: Code needed for the testBalanceIsInitiallyZero() test to pass</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
class BankAccount {
    private $balance = 0;

    public function getBalance() {
        return $this-&gt;balance;
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      The test for the first contract condition now passes, but the tests for
      the second contract condition fail because we have yet to implement the
      methods that these tests call.
    </p><pre class="screen"><strong class="userinput"><code>phpunit BankAccountTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

.
Fatal error: Call to undefined method BankAccount::withdrawMoney()</pre><p>
      For the tests that ensure the second contract condition to pass, we now
      need to implement the <code class="literal">withdrawMoney()</code>,
      <code class="literal">depositMoney()</code>, and <code class="literal">setBalance()</code>
      methods, as shown in
      <a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccount2.php" title="Example 8.3: The complete BankAccount class">Example 8.3</a>.
      These methods are written in a such a way that they raise an
      <code class="literal">InvalidArgumentException</code> when they are called with
      illegal values that would violate the contract conditions.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount2.php"></a><p class="title"><strong>Example 8.3: The complete BankAccount class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
class BankAccount {
    private $balance = 0;

    public function getBalance() {
        return $this-&gt;balance;
    }

    public function setBalance($balance) {
        if ($balance &gt;= 0) {
            $this-&gt;balance = $balance;
        } else {
            throw new InvalidArgumentException;
        }
    }

    public function depositMoney($amount) {
        if ($amount &gt;= 0) {
            $this-&gt;balance += $amount;
        } else {
            throw new InvalidArgumentException;
        }
    }

    public function withdrawMoney($amount) {
        if ($amount &gt;= 0 &amp;&amp; $this-&gt;balance &gt;= $amount) {
            $this-&gt;balance -= $amount;
        } else {
            throw new InvalidArgumentException;
        }
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      The tests that ensure the second contract condition now pass, too:
    </p><pre class="screen"><strong class="userinput"><code>phpunit BankAccountTest</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

....

Time: 0.057038

OK (4 tests)</pre><p>
      <a id="idm140466932857744" class="indexterm"></a>

      Alternatively, you can use the static assertion methods provided by the
      <code class="literal">PHPUnit2_Framework_Assert</code> class to write the contract
      conditions as design-by-contract style assertions into your code, as
      shown in <a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccount3.php" title="Example 8.4: The BankAccount class with Design-by-Contract assertions">Example 8.4</a>.
      When one of these assertions fails, an
      <code class="literal">PHPUnit2_Framework_AssertionFailedError</code> exception
      will be raised. With this approach, you write less code for the contract
      condition checks and the tests become more readable. However, you add a
      runtime dependency on PHPUnit to your project.
    </p><div class="example"><a id="test-first-programming.bankaccount-example.examples.BankAccount3.php"></a><p class="title"><strong>Example 8.4: The BankAccount class with Design-by-Contract assertions</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/Assert.php';

class BankAccount {
    private $balance = 0;

    public function getBalance() {
        return $this-&gt;balance;
    }

    public function setBalance($balance) {
        PHPUnit2_Framework_Assert::assertTrue($balance &gt;= 0);

        $this-&gt;balance = $balance;
    }

    public function depositMoney($amount) {
        PHPUnit2_Framework_Assert::assertTrue($amount &gt;= 0);

        $this-&gt;balance += $amount;
    }

    public function withdrawMoney($amount) {
        PHPUnit2_Framework_Assert::assertTrue($amount &gt;= 0);
        PHPUnit2_Framework_Assert::assertTrue($this-&gt;balance &gt;= $amount);

        $this-&gt;balance -= $amount;
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      By writing the contract conditions into the tests, we have used
      Design-by-Contract to program the <code class="literal">BankAccount</code> class.
      We then wrote, following the Test-First Programming approach, the
      code needed to make the tests pass. However, we forgot to write
      tests that call <code class="literal">setBalance()</code>,
      <code class="literal">depositMoney()</code>, and <code class="literal">withdrawMoney()</code>
      with legal values that do not violate the contract conditions.
      We need a means to test our tests or at least to measure their quality.
      Such a means is the analysis of code-coverage information that we will
      discuss next.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="code-coverage-analysis"></a>Chapter 9. Code-Coverage Analysis</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    You have learned how to use unit tests to test your code. But how do you
    test your tests? How do you find code that is not yet tested -- or, in
    other words, not yet <span class="emphasis"><em>covered</em></span> by a test? How do you
    measure testing completeness? All these questions are answered by a
    practice called Code-Coverage Analysis. Code-Coverage Analysis gives you
    an insight into what parts of the production code are executed when the
    tests are run.
  </p><p>
    <a id="idm140466932894256" class="indexterm"></a>

    PHPUnit's Code-Coverage Analysis utilizes the statement coverage
    functionality provided by the <a class="ulink" href="http://www.xdebug.org/" target="_top">Xdebug</a>
    extension. An example of what statement coverage means is that if there is
    a method with 100 lines of code, and only 75 of these lines are actually
    executed when tests are being run, then the method is considered to have a
    code coverage of 75 percent.
  </p><p>
    <a class="xref" href="#code-coverage-analysis.figures.CodeCoverage.png" title="Figure 9.1. The BankAccount class, not completeley covered by tests">Figure 9.1</a> shows
    a code-coverage report for the <code class="literal">BankAccount</code> class (from
    <a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccount2.php" title="Example 8.3: The complete BankAccount class">Example 8.3</a>)
    in HTML format generated by the PHPUnit command-line test runner's
    <code class="literal">--coverage-html</code> switch. Executable code lines are
    black; non-executable code lines are gray. Code lines that are actually
    executed are highlighted.
  </p><div class="figure"><a id="code-coverage-analysis.figures.CodeCoverage.png"></a><p class="title"><strong>Figure 9.1. The BankAccount class, not completeley covered by tests</strong></p><div class="figure-contents"><div><img src="figures/CodeCoverage.png" alt="The BankAccount class, not completeley covered by tests" /></div></div></div><br class="figure-break" /><p>
    The code-coverage report shows that we need to write tests that call
    <code class="literal">setBalance()</code>, <code class="literal">depositMoney()</code>, and
    <code class="literal">withdrawMoney()</code> with legal values in order to achieve
    complete code-coverage.
    <a class="xref" href="#code-coverage-analysis.examples.BankAccountTest.php" title="Example 9.1: The BankAccount class, completeley covered by tests">Example 9.1</a>
    shows tests that need to be added to the <code class="literal">BankAccountTest</code>
    test-case class to completely cover the <code class="literal">BankAccount</code>
    class.
  </p><div class="example"><a id="code-coverage-analysis.examples.BankAccountTest.php"></a><p class="title"><strong>Example 9.1: The BankAccount class, completeley covered by tests</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';
require_once 'BankAccount.php';

class BankAccountTest extends PHPUnit2_Framework_TestCase {
    // ...

    public function testSetBalance() {
        $this-&gt;ba-&gt;setBalance(1);
        $this-&gt;assertEquals(1, $this-&gt;ba-&gt;getBalance());
    }

    public function testDepositAndWidthdrawMoney() {
        $this-&gt;ba-&gt;depositMoney(1);
        $this-&gt;assertEquals(1, $this-&gt;ba-&gt;getBalance());

        $this-&gt;ba-&gt;withdrawMoney(1);
        $this-&gt;assertEquals(0, $this-&gt;ba-&gt;getBalance());
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    In <a class="xref" href="#code-coverage-analysis.figures.CodeCoverage2.png" title="Figure 9.2. The BankAccount class is completely covered by tests">Figure 9.2</a>,
    we see that the <code class="literal">BankAccount</code> class is now completely
    covered by tests.
  </p><div class="figure"><a id="code-coverage-analysis.figures.CodeCoverage2.png"></a><p class="title"><strong>Figure 9.2. The BankAccount class is completely covered by tests</strong></p><div class="figure-contents"><div><img src="figures/CodeCoverage2.png" alt="The BankAccount class is completely covered by tests" /></div></div></div><br class="figure-break" /><p>
    In <a class="xref" href="#phing" title="Chapter 12. PHPUnit and Phing">Chapter 12</a> you will learn how to use Phing to generate
    more detailed code-coverage reports.
  </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="stubs"></a>Chapter 10. Stubs</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    <a id="idm140466932800656" class="indexterm"></a>

    Tests that only test one thing are more informative than tests where
    failure can come from many sources. How can you isolate your tests from
    external influences? Simply put, by replacing the expensive, messy,
    unreliable, slow, complicated resources with stubs made from plain PHP
    objects. For example, you can implement what is in reality a complicated
    computation by returning a constant, at least for the purposes of a
    single test.
  </p><p>
    <a id="idm140466932825744" class="indexterm"></a>

    Stubs solve the problem of allocating expensive external resources.
    For example, sharing a resource, such as a database connection, between
    tests by using the <code class="literal">PHPUnit2_Extensions_TestSetup</code>
    decorator helps, but not using the database for the purposes of the tests
    at all is even better.
  </p><p>
    Design improvement is one effect of using stubs. Widely used resources
    are accessed through a single façade, so you can easily replace the
    resource with the stub. For example, instead of having direct database
    calls scattered throughout the code, you have a single
    <code class="literal">Database</code> object, an implementor of the
    <code class="literal">IDatabase</code> interface. Then, you can create a stub
    implementation of <code class="literal">IDatabase</code> and use it for your
    tests. You can even create an option for running the tests with the
    stub database or the real database, so you can use your tests for both
    local testing during development and integration testing with the real
    database.
  </p><p>
    Functionality that needs to be stubbed out tends to cluster in the same
    object, improving cohesion. By presenting the functionality with a
    single, coherent interface, you reduce the coupling with the rest of the
    system.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="stubs.self-shunting"></a>Self-Shunting</h2></div></div></div><p>
      <a id="idm140466932745200" class="indexterm"></a>

      Sometimes you need to check that an object has been called correctly. You
      can create a complete stub of the object to be called, but that can make
      it inconvenient to check for correct results. A simpler solution is to
      apply the <span class="emphasis"><em>Self Shunt Pattern</em></span> and use the test-case
      object itself as a stub. The term self-shunting is taken from the medical
      practice of installing a tube that takes blood from an artery and returns
      it to a vein to provide a convenient place for injecting drugs.
    </p><p>
      <a id="idm140466932743136" class="indexterm"></a>

      Here is an example: suppose we want to test that the correct method is
      called on an object that observes another object. First, we make our
      test-case class an implementor of <code class="literal">Observer</code>:
</p><pre class="programlisting">class ObserverTest extends PHPUnit2_Framework_TestCase implements Observer {
}</pre><p>
    </p><p>
      Next, we implement the one <code class="literal">Observer</code> method,
      <code class="literal">update()</code>, to check that it is called when the state
      of the observed <code class="literal">Subject</code> object changes:
</p><pre class="programlisting">public $wasCalled = FALSE;

public function update(Subject $subject) {
    $this-&gt;wasCalled = TRUE;
}</pre><p>
    </p><p>
      Now, we can write our test. We create a new <code class="literal">Subject</code>
      object and attach the test object to it as an observer. When the state
      of the <code class="literal">Subject</code> changes -- for instance, by calling its
      <code class="literal">doSomething()</code> method -- the <code class="literal">Subject</code>
      object has to call the <code class="literal">update()</code> method on all objects
      that are registered as observers. We use the <code class="literal">$wasCalled</code>
      instance variable that is set by our implementation of
      <code class="literal">update()</code> to check whether the <code class="literal">Subject</code>
      object does what it is supposed to do:

</p><pre class="programlisting">public function testUpdate() {
    $subject = new Subject;
    $subject-&gt;attach($this);
    $subject-&gt;doSomething();

    $this-&gt;assertTrue($this-&gt;wasCalled);
}</pre><p>
    </p><p>
      Notice that we create a new <code class="literal">Subject</code> object instead of
      relying on a global instance. Stubbing encourages this style of design.
      It reduces the coupling between objects and improves reuse.
    </p><p>
      If you are not familiar with the self-shunt pattern, the tests can be
      hard to read. What is going on here? Why is a test case also an
      observer? Once you get used to the idiom, the tests are easy to read.
      Everything you need to understand the test is in one class.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="other-uses-for-tests"></a>Chapter 11. Other Uses for Tests</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    Once you get used to writing automated tests, you will likely discover
    more uses for tests. Here are some examples.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="other-uses-for-tests.agile-documentation"></a>Agile Documentation</h2></div></div></div><p>
      <a id="idm140466932768928" class="indexterm"></a>
      <a id="idm140466932688912" class="indexterm"></a>
      <a id="idm140466932688160" class="indexterm"></a>
      <a id="idm140466932687408" class="indexterm"></a>

      Typically, in a project that is developed using an agile process,
      such as Extreme Programming, the documentation cannot keep up with the
      frequent changes to the project's design and code. Extreme Programming
      demands <span class="emphasis"><em>collective code ownership</em></span>, so all
      developers need to know how the entire system works. If you are
      disciplined enough to consequently use "speaking names" for your tests
      that describe what a class should do, you can use PHPUnit's TestDox
      functionality to generate automated documentation for your project based
      on its tests. This documentation gives developers an overview of what
      each class of the project is supposed to do.
    </p><p>
      PHPUnit's TestDox functionality looks at a test class and all the test
      method names and converts them from camel case PHP names to sentences:
      <code class="literal">testBalanceIsInitiallyZero()</code> becomes "Balance is
      initially zero". If there are several test methods whose names only
      differ in a suffix of one or more digits, such as
      <code class="literal">testBalanceCannotBecomeNegative()</code> and
      <code class="literal">testBalanceCannotBecomeNegative2()</code>, the sentence
      "Balance cannot become negative" will appear only once, assuming that
      all of these tests succeed.
    </p><p>
      The following code shows the agile documentation for the
      <code class="literal">BankAccount</code> class (from
      <a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccountTest.php" title="Example 8.1: Tests for the BankAccount class">Example 8.1</a>)
      generated by running <strong class="userinput"><code>phpunit --testdox-text BankAccountTest.txt BankAccountTest</code></strong>:
    </p><pre class="screen">BankAccount
 - Balance is initially zero
 - Balance cannot become negative</pre><p>
      Alternatively, the agile documentation can be generated in HTML format
      by using <code class="literal">--testdox-html BankAccountTest.htm</code>.
    </p><p>
      <a id="idm140466932678448" class="indexterm"></a>

      Agile Documentation can be used to document the assumptions you make
      about the external packages that you use in your project. When you use
      an external package, you are exposed to the risks that the package will
      not behave as you expect, and that future versions of the package will
      change in subtle ways that will break your code, without you knowing it.
      You can address these risks by writing a test every time you make an
      assumption. If your test succeeds, your assumption is valid. If you
      document all your assumptions with tests, future releases of the
      external package will be no cause for concern: if the tests succeed,
      your system should continue working.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="other-uses-for-tests.cross-team-tests"></a>Cross-Team Tests</h2></div></div></div><p>
      When you document assumptions with tests, you own the tests. The
      supplier of the package -- who you make assumptions about -- knows
      nothing about your tests. If you want to have a closer relationship
      with the supplier of a package, you can use the tests to communicate
      and coordinate your activities.
    </p><p>
      When you agree on coordinating your activities with the supplier of a
      package, you can write the tests together. Do this in such a way that
      the tests reveal as many assumptions as possible. Hidden assumptions are
      the death of cooperation. With the tests, you document exactly what you
      expect from the supplied package. The supplier will know the package is
      complete when all the tests run.
    </p><p>
      <a id="idm140466932673984" class="indexterm"></a>

      By using stubs (see the section "Stubs", earlier in this book), you can
      further decouple yourself from the supplier: The job of the supplier is
      to make the tests run with the real implementation of the package. Your
      job is to make the tests run for your own code. Until such time as you
      have the real implementation of the supplied package, you use stub
      objects. Following this approach, the two teams can develop
      independently.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="other-uses-for-tests.debugging-tests"></a>Debugging Tests</h2></div></div></div><p>
      When you get a defect report, your impulse might be to fix the defect as
      quickly as possible. Experience shows that this impulse will not serve
      you well; it is likely that the fix for the defect causes another
      defect.
    </p><p>
      You can hold your impulse in check by doing the following:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Verify that you can reproduce the defect.
        </p></li><li class="listitem"><p>
          Find the smallest-scale demonstration of the defect in the code.
          For example, if a number appears incorrectly in an output, find the
          object that is computing that number.
        </p></li><li class="listitem"><p>
          Write an automated test that fails now but will succeed when the
          defect is fixed.
        </p></li><li class="listitem"><p>
          Fix the defect.
        </p></li></ol></div><p>
      Finding the smallest reliable reproduction of the defect gives you the
      opportunity to really examine the cause of the defect. The test you
      write will improve the chances that when you fix the defect, you really
      fix it, because the new test reduces the likelihood of undoing the fix
      with future code changes. All the tests you wrote before reduce the
      likelihood of inadvertently causing a different problem.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="other-uses-for-tests.refactoring"></a>Refactoring</h2></div></div></div><p>
      <a id="idm140466932664016" class="indexterm"></a>

      Refactoring, the controlled technique for improving the design of an
      existing code base, can be applied safely only when you have a test
      suite. Otherwise, you might not notice the system breaking while you are
      carrying out the restructuring. Refactoring can be broken down into
      a series of small behavior-preserving transformations.
    </p><p>
      The following conditions will help you to improve the code and design
      of your project, while using unit tests to verify that the refactoring's
      transformation steps are, indeed, behavior-preserving and do not
      introduce errors:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>All unit tests run correctly.</p></li><li class="listitem"><p>The code communicates its design principles.</p></li><li class="listitem"><p>The code contains no redundancies.</p></li><li class="listitem"><p>The code contains the minimal number of classes and methods.</p></li></ol></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="phing"></a>Chapter 12. PHPUnit and Phing</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    <a id="idm140466932706272" class="indexterm"></a>

    <a class="ulink" href="http://www.phing.info/" target="_top">Phing (PHing Is Not GNU make)</a>
    is a project build system based on
    <a class="ulink" href="http://ant.apache.org/" target="_top">Apache Ant</a>. In the context of
    PHP, where you do not need to build and compile your sources, the
    intention of Phing is to ease the packaging, deployment, and testing of
    applications. For these tasks, Phing provides numerous out-of-the-box
    operation modules ("tasks") and an easy-to-use, object-oriented model
    for adding your own custom tasks.
  </p><p>
    Phing can be installed using the PEAR Installer, as shown in
    the following command line:
  </p><pre class="screen"><strong class="userinput"><code>pear channel-discover pear.phing.info
pear install phing/phing</code></strong></pre><p>
    Phing uses simple XML build files that specify a target tree where
    various tasks get executed. One of the out-of-the-box tasks that comes
    with Phing is the <code class="literal">&lt;phpunit2&gt;</code> task that
    runs test cases using the PHPUnit framework. It is a functional port of
    Apache Ant's JUnit task.
  </p><p>
    <a class="xref" href="#phing.examples.build.xml" title="Example 12.1: Phing build.xml file for the BankAccount tests">Example 12.1</a> shows a Phing
    <code class="filename">build.xml</code> file that specifies a
    <code class="literal">&lt;project&gt;</code> named "BankAccount". The
    project's default <code class="literal">&lt;target&gt;</code> is called
    <span class="emphasis"><em>test</em></span>. Using the <code class="literal">&lt;phpunit2&gt;</code>
    task, this target runs all test cases that can be found in source files
    that match the <code class="literal">*Test.php</code> condition. This is done by
    using a <code class="literal">&lt;batchtest&gt;</code> element that collects
    the included files from any number of nested <code class="literal">&lt;fileset&gt;</code>
    elements. In this example, the tests declared in the class
    <code class="literal">BankAccountTest</code> in the source file
    <code class="filename">BankAccountTest.php</code> will be run.
  </p><div class="example"><a id="phing.examples.build.xml"></a><p class="title"><strong>Example 12.1: Phing build.xml file for the BankAccount tests</strong></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0"?&gt;

&lt;project name="BankAccount" basedir="." default="test"&gt;
  &lt;target name="test"&gt;
    &lt;phpunit2 haltonfailure="true" printsummary="true"&gt;
      &lt;batchtest&gt;
        &lt;fileset dir="."&gt;
          &lt;include name="*Test.php"/&gt;
        &lt;/fileset&gt;
      &lt;/batchtest&gt;
    &lt;/phpunit2&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre></div></div><br class="example-break" /><p>
    Invoking Phing in the directory that contains <code class="filename">build.xml</code>
    (<a class="xref" href="#phing.examples.build.xml" title="Example 12.1: Phing build.xml file for the BankAccount tests">Example 12.1</a>),
    <code class="filename">BankAccount.php</code>
    (<a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccount2.php" title="Example 8.3: The complete BankAccount class">Example 8.3</a>),
    and <code class="filename">BankAccountTest.php</code>
    (<a class="xref" href="#test-first-programming.bankaccount-example.examples.BankAccountTest.php" title="Example 8.1: Tests for the BankAccount class">Example 8.1</a>)
    will run the tests by executing the project's default target,
    <span class="emphasis"><em>tests</em></span>:
  </p><pre class="screen"><strong class="userinput"><code>phing</code></strong>
Buildfile: /home/sb/build.xml

BankAccount &gt; test:
 [phpunit2] Tests run: 4, Failures: 0, Errors: 0, Time elapsed: 0.00067 sec

BUILD FINISHED

Total time: 0.0960 seconds</pre><p>
    <a class="xref" href="#phing.tables.phpunit2" title="Table 12.1. Attributes for the &lt;phpunit2&gt; element">Table 12.1</a> shows the parameters that
    can be used to configure the <code class="literal">&lt;phpunit2&gt;</code>
    task.
  </p><div class="table"><a id="phing.tables.phpunit2"></a><p class="title"><strong>Table 12.1. Attributes for the &lt;phpunit2&gt; element</strong></p><div class="table-contents"><table class="table" summary="Attributes for the &lt;phpunit2&gt; element" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th><th align="left">Default</th></tr></thead><tbody><tr><td align="left"><code class="literal">codecoverage</code></td><td align="left"><code class="literal">Boolean</code></td><td align="left">Collect Code Coverage information.</td><td align="left"><code class="literal">false</code></td></tr><tr><td align="left"><code class="literal">haltonerror</code></td><td align="left"><code class="literal">Boolean</code></td><td align="left">Stops the build process if an error occurs during the test run.</td><td align="left"><code class="literal">false</code></td></tr><tr><td align="left"><code class="literal">haltonfailure</code></td><td align="left"><code class="literal">Boolean</code></td><td align="left">Stops the build process if a test fails. Errors are considered failures as well.</td><td align="left"><code class="literal">false</code></td></tr><tr><td align="left"><code class="literal">printsummary</code></td><td align="left"><code class="literal">Boolean</code></td><td align="left">Prints one-line statistics for each test case.</td><td align="left"><code class="literal">false</code></td></tr></tbody></table></div></div><br class="table-break" /><p>
    The following example shows the
    <code class="literal">&lt;phpunit2&gt;</code> task's output when a test
    fails:
  </p><pre class="screen"><strong class="userinput"><code>phing</code></strong>
Buildfile: /home/sb/build.xml

BankAccount &gt; test:
 [phpunit2] Tests run: 4, Failures: 1, Errors: 0, Time elapsed: 0.00067 sec
Execution of target "test" failed for the following reason:
/home/sb/build.xml:5:37: One or more tests failed

BUILD FAILED
/home/sb/build.xml:5:37: One or more tests failed
Total time: 0.0968 seconds</pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="phing.formatting-feedback"></a>Formatting Feedback</h2></div></div></div><p>
      Besides the required <code class="literal">&lt;batchtest&gt;</code> element,
      the <code class="literal">&lt;phpunit2&gt;</code> element allows for
      another nested element: <code class="literal">&lt;formatter&gt;</code> is
      used to write test results in different formats. Output will always be
      sent to a file, unless you set the <code class="literal">usefile</code> attribute
      to <code class="literal">false</code>. The name of the file is predetermined by
      the formatter and can be changed by the <code class="literal">outfile</code>
      attribute. There are three predefined formatters:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">brief</code></span></dt><dd><p>
            Prints detailed information in plain text only for test cases
            that failed.
          </p></dd><dt><span class="term"><code class="literal">plain</code></span></dt><dd><p>
            Prints one-line statistics in plain text for all test cases.
          </p></dd><dt><span class="term"><code class="literal">xml</code></span></dt><dd><p>
            Writes the test results in XML format.
          </p></dd></dl></div><p>
      <a class="xref" href="#phing.formatting-feedback.tables.formatter" title="Table 12.2. Attributes for the &lt;formatter&gt; element">Table 12.2</a> shows the
      parameters that can be used to configure the
      <code class="literal">&lt;formatter&gt;</code> task.
    </p><div class="table"><a id="phing.formatting-feedback.tables.formatter"></a><p class="title"><strong>Table 12.2. Attributes for the &lt;formatter&gt; element</strong></p><div class="table-contents"><table class="table" summary="Attributes for the &lt;formatter&gt; element" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th><th align="left">Default</th></tr></thead><tbody><tr><td align="left"><code class="literal">type</code></td><td align="left"><code class="literal">String</code></td><td align="left">Use a predefined formatter (xml, plain, or brief).</td><td align="left"> </td></tr><tr><td align="left"><code class="literal">classname</code></td><td align="left"><code class="literal">String</code></td><td align="left">Name of a custom formatter class.</td><td align="left"> </td></tr><tr><td align="left"><code class="literal">usefile</code></td><td align="left"><code class="literal">Boolean</code></td><td align="left">Determines whether output should be sent to a file.</td><td align="left"><code class="literal">true</code></td></tr><tr><td align="left"><code class="literal">todir</code></td><td align="left"><code class="literal">String</code></td><td align="left">Directory the file is written to.</td><td align="left"> </td></tr><tr><td align="left"><code class="literal">outfile</code></td><td align="left"><code class="literal">String</code></td><td align="left">Name of the file that is written to.</td><td align="left"><code class="literal">Depends on the formatter used.</code></td></tr></tbody></table></div></div><br class="table-break" /><p>
      <a id="idm140466932540272" class="indexterm"></a>

      To generate a test report in HTML format, you can use the
      <code class="literal">&lt;phpunit2report&gt;</code> task, which applies an
      XSLT stylesheet to the XML logfile created by the
      <code class="literal">&lt;formatter&gt;</code> task. Phing ships with two
      XSLT stylesheets -- <code class="filename">phpunit2-frames.xsl</code> and
      <code class="filename">phpunit2-noframes.xsl</code> -- that generate HTML reports
      with or without frames, respectively.
    </p><p>
      <a class="xref" href="#phing.formatting-feedback.examples.build2.xml" title="Example 12.2: Applying an XSLT stylesheet to get a test report">Example 12.2</a> shows
      a <code class="filename">build.xml</code> file for Phing that runs the tests from
      the <code class="literal">BankAccountTest</code> class and generates a test report
      in HTML format using the <code class="filename">phpunit2-frames.xsl</code> XSLT
      stylesheet. The HTML files generated for the report will be written to
      the <code class="filename">report/</code> directory that is created by the
      <span class="emphasis"><em>prepare</em></span> <code class="literal">&lt;target&gt;</code> and
      deleted by the <span class="emphasis"><em>clean</em></span>
      <code class="literal">&lt;target&gt;</code>.
    </p><div class="example"><a id="phing.formatting-feedback.examples.build2.xml"></a><p class="title"><strong>Example 12.2: Applying an XSLT stylesheet to get a test report</strong></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0"?&gt;

&lt;project name="BankAccount" basedir="." default="report"&gt;
  &lt;target name="prepare"&gt;
    &lt;mkdir dir="report"/&gt;
  &lt;/target&gt;

  &lt;target name="clean"&gt;
    &lt;delete dir="report"/&gt;
  &lt;/target&gt;

  &lt;target name="report" depends="prepare"&gt;
    &lt;phpunit2&gt;
      &lt;batchtest&gt;
        &lt;fileset dir="."&gt;
          &lt;include name="*Test.php"/&gt;
        &lt;/fileset&gt;
      &lt;/batchtest&gt;

      &lt;formatter type="xml" todir="report" outfile="logfile.xml"/&gt;
    &lt;/phpunit2&gt;

    &lt;phpunit2report infile="report/logfile.xml"
                    styledir="/usr/lib/php/data/phing/etc"
                    format="frames"
                    todir="report"/&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre></div></div><br class="example-break" /><p>
      The following example shows the output of the <code class="literal">phing</code>
      command as it runs:
    </p><pre class="screen"><strong class="userinput"><code>phing</code></strong>
Buildfile: /home/sb/build.xml

BankAccount &gt; prepare:
    [mkdir] Created dir: /home/sb/report

BankAccount &gt; report:

BUILD FINISHED

Total time: 0.1112 seconds</pre><p>
      <a class="xref" href="#phing.formatting-feedback.figures.Report.png" title="Figure 12.1. The generated test report">Figure 12.1</a> shows
      the title page of the generated test report.
    </p><div class="figure"><a id="phing.formatting-feedback.figures.Report.png"></a><p class="title"><strong>Figure 12.1. The generated test report</strong></p><div class="figure-contents"><div><img src="figures/Report.png" alt="The generated test report" /></div></div></div><br class="figure-break" /><p>
      <a class="xref" href="#phing.formatting-feedback.tables.phpunit2report" title="Table 12.3. Attributes for the &lt;phpunit2report&gt; element">Table 12.3</a> shows
      the parameters that can be used to configure the
      <code class="literal">&lt;phpunit2report&gt;</code> task.
    </p><div class="table"><a id="phing.formatting-feedback.tables.phpunit2report"></a><p class="title"><strong>Table 12.3. Attributes for the &lt;phpunit2report&gt; element</strong></p><div class="table-contents"><table class="table" summary="Attributes for the &lt;phpunit2report&gt; element" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th><th align="left">Default</th></tr></thead><tbody><tr><td align="left"><code class="literal">infile</code></td><td align="left"><code class="literal">String</code></td><td align="left">The filename of the XML results file to use.</td><td align="left"><code class="literal">testsuites.xml</code></td></tr><tr><td align="left"><code class="literal">format</code></td><td align="left"><code class="literal">String</code></td><td align="left">The format of the generated report. Must be <code class="literal">frames</code> or <code class="literal">noframes</code>.</td><td align="left"><code class="literal">noframes</code></td></tr><tr><td align="left"><code class="literal">styledir</code></td><td align="left"><code class="literal">String</code></td><td align="left">The directory where the stylesheets are located. The stylesheets must conform to the following conventions: the stylesheet for the <code class="literal">frames</code> format must be named <code class="filename">phpunit2-frames.xsl</code>, the stylesheet for the <code class="literal">noframes</code> format must be named <code class="filename">phpunit2-noframes.xsl</code>.</td><td align="left"> </td></tr><tr><td align="left"><code class="literal">todir</code></td><td align="left"><code class="literal">String</code></td><td align="left">The directory where the files resulting from the transformation should be written to.</td><td align="left"> </td></tr></tbody></table></div></div><br class="table-break" /><p>
      <a id="idm140466932502064" class="indexterm"></a>

      In addition to the test report that we just generated, Phing can
      generate a code-coverage report. For this, we need the
      <code class="literal">&lt;coverage-setup&gt;</code> and
      <code class="literal">&lt;coverage-report&gt;</code> tasks. The former
      prepares a database in which code-coverage information is stored while
      the tests are run; the latter formats such a database into a report in
      HTML format using XSLT stylesheets.
    </p><p>
      <a class="xref" href="#phing.formatting-feedback.examples.build3.xml" title="Example 12.3: Generating a code-coverage report">Example 12.3</a> shows
      a <code class="filename">build.xml</code> file for Phing that runs the tests from
      the <code class="literal">BankAccountTest</code> class and generates a
      code-coverage report in HTML format.
    </p><div class="example"><a id="phing.formatting-feedback.examples.build3.xml"></a><p class="title"><strong>Example 12.3: Generating a code-coverage report</strong></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0"?&gt;

&lt;project name="BankAccount" basedir="." default="coverage-report"&gt;
  &lt;target name="prepare"&gt;
    &lt;mkdir dir="coverage-report"/&gt;
  &lt;/target&gt;

  &lt;target name="clean"&gt;
    &lt;delete dir="coverage-report"/&gt;
  &lt;/target&gt;

  &lt;target name="coverage-report" depends="prepare"&gt;
    &lt;coverage-setup database="./coverage-report/database"&gt;
      &lt;fileset dir="."&gt;
        &lt;include name="*.php"/&gt;
        &lt;exclude name="*Test.php"/&gt;
      &lt;/fileset&gt;
    &lt;/coverage-setup&gt;

    &lt;phpunit2 codecoverage="true"&gt;
      &lt;batchtest&gt;
        &lt;fileset dir="."&gt;
          &lt;include name="*Test.php"/&gt;
        &lt;/fileset&gt;
      &lt;/batchtest&gt;
    &lt;/phpunit2&gt;

    &lt;coverage-report outfile="coverage-report/coverage.xml"&gt;
      &lt;report styledir="/usr/lib/php/data/phing/etc"
              todir="coverage-report"/&gt;
    &lt;/coverage-report&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre></div></div><br class="example-break" /><p>
      <a class="xref" href="#phing.formatting-feedback.figures.CoverageReport.png" title="Figure 12.2. The generated code-coverage report">Figure 12.2</a>
      shows the title page of the generated code-coverage report.
    </p><div class="figure"><a id="phing.formatting-feedback.figures.CoverageReport.png"></a><p class="title"><strong>Figure 12.2. The generated code-coverage report</strong></p><div class="figure-contents"><div><img src="figures/CoverageReport.png" alt="The generated code-coverage report" /></div></div></div><br class="figure-break" /></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="implementation"></a>Chapter 13. PHPUnit's Implementation</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    The implementation of PHPUnit is a bit unusual, using techniques
    that are difficult to maintain in ordinary application code.
    Understanding how PHPUnit runs your tests can help you write
    them.
  </p><p>
    <a id="idm140466932416096" class="indexterm"></a>
    <a id="idm140466932362432" class="indexterm"></a>
    <a id="idm140466932361680" class="indexterm"></a>

    A single test is represented by a <code class="literal">PHPUnit2_Framework_Test</code>
    object and requires a <code class="literal">PHPUnit2_Framework_TestResult</code>
    object to be run. The <code class="literal">PHPUnit2_Framework_TestResult</code>
    object is passed to the <code class="literal">PHPUnit2_Framework_Test</code>
    object's <code class="literal">run()</code> method, which runs the actual test
    method and reports any exceptions to the
    <code class="literal">PHPUnit2_Framework_TestResult</code> object. This is an
    idiom from the Smalltalk world called <span class="emphasis"><em>Collecting Parameter</em></span>.
    It suggests that when you need to collect results over several methods
    (in our case the result of the serveral invocations of the
    <code class="literal">run()</code> method for the various tests), you should add a
    parameter to the method and pass an object that will collect the results
    for you. See the article "JUnit: A
    Cook's Tour" by Erich Gamma and Kent Beck <a class="xref" href="#GammaBeck1999" title="JUnit: A Cook's Tour">[<abbr class="abbrev">GammaBeck1999</abbr>]</a>
    and "Smalltalk Best Practice Patterns" by Kent Beck <a class="xref" href="#Beck1997" title="Smalltalk Best Practice Patterns">[<abbr class="abbrev">Beck1997</abbr>]</a>.
  </p><p>
    To further understand how PHPUnit runs your tests, consider the test-case
    class in <a class="xref" href="#implementation.examples.EmptyTest.php" title="Example 13.1: The EmptyTest class">Example 13.1</a>.
  </p><div class="example"><a id="implementation.examples.EmptyTest.php"></a><p class="title"><strong>Example 13.1: The EmptyTest class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';

class EmptyTest extends PHPUnit2_Framework_TestCase {
    private $emptyArray = array();

    public function testSize() {
        $this-&gt;assertEquals(0, sizeof($this-&gt;emptyArray));
    }

    public function testIsEmpty() {
        $this-&gt;assertTrue(empty($this-&gt;emptyArray));
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    <a id="idm140466932351472" class="indexterm"></a>
    <a id="idm140466932350720" class="indexterm"></a>

    When the test is run, the first thing PHPUnit does is convert the
    test class into a <code class="literal">PHPUnit2_Framework_Test</code> object --
    here, a <code class="literal">PHPUnit2_Framework_TestSuite</code> containing
    two instances of <code class="literal">EmptyTest</code>, as shown in
    <a class="xref" href="#implementation.figures.EmptyTest-before.png" title="Figure 13.1. Tests about to be run">Figure 13.1</a>.
  </p><div class="figure"><a id="implementation.figures.EmptyTest-before.png"></a><p class="title"><strong>Figure 13.1. Tests about to be run</strong></p><div class="figure-contents"><div><img src="figures/EmptyTest-before.png" alt="Tests about to be run" /></div></div></div><br class="figure-break" /><p>
    <a id="idm140466932345360" class="indexterm"></a>

    When the <code class="literal">PHPUnit2_Framework_TestSuite</code> is run, it runs
    each of the <code class="literal">EmptyTest</code>s in turn. Each runs its own
    <code class="literal">setUp()</code> method, creating a fresh
    <code class="literal">$emptyArray</code> for each test, as shown in
    <a class="xref" href="#implementation.figures.EmptyTest-after.png" title="Figure 13.2. Tests after running, each with its own fixture">Figure 13.2</a>. This way,
    if one test modifies the array, the other test will not be affected. Even
    changes to global and super-global (like <code class="literal">$_ENV</code>)
    variables do not affect other tests.
  </p><div class="figure"><a id="implementation.figures.EmptyTest-after.png"></a><p class="title"><strong>Figure 13.2. Tests after running, each with its own fixture</strong></p><div class="figure-contents"><div><img src="figures/EmptyTest-after.png" alt="Tests after running, each with its own fixture" /></div></div></div><br class="figure-break" /><p>
    In short, one test-case class results in a two-level tree of objects
    when the tests are run. Each test method works with its own copy of the
    objects created by <code class="literal">setUp()</code>. The result is tests that
    can run completely independently.
  </p><p>
    <a id="idm140466932337440" class="indexterm"></a>

    To run the test method itself, PHPUnit uses reflection to find the
    method name in the instance variable <code class="literal">$name</code> and invokes
    it. This is another idiom, called <span class="emphasis"><em>Pluggable Selector</em></span>,
    that is commonly used in the Smalltalk world. Using a Pluggable Selector
    makes the writing of tests simpler, but there is a tradeoff: you cannot
    look at the code to decide whether a method is invoked, you have to look
    at the data values at runtime.
  </p></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="api"></a>Chapter 14. PHPUnit API</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    For most uses, PHPUnit has a simple API: subclass
    <code class="literal">PHPUnit2_Framework_TestCase</code> for your test cases and
    call <code class="literal">assertTrue()</code> or <code class="literal">assertEquals()</code>.
    However, for those of you who would like to look deeper into PHPUnit,
    here are all of its published methods and classes.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.overview"></a>Overview</h2></div></div></div><p>
      Most of the time, you will encounter five classes or interfaces when you
      are using PHPUnit:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">PHPUnit2_Framework_Assert</code></span></dt><dd><p>
          A collection of static methods for checking actual values against
          expected values.
          </p></dd><dt><span class="term"><code class="literal">PHPUnit2_Framework_Test</code></span></dt><dd><p>
            The interface of all objects that act like tests.
          </p></dd><dt><span class="term"><code class="literal">PHPUnit2_Framework_TestCase</code></span></dt><dd><p>
            A single test.
          </p></dd><dt><span class="term"><code class="literal">PHPUnit2_Framework_TestSuite</code></span></dt><dd><p>
            A collection of tests.
          </p></dd><dt><span class="term"><code class="literal">PHPUnit2_Framework_TestResult</code></span></dt><dd><p>
            A summary of the results of running one or more tests.
          </p></dd></dl></div><p>
      <a class="xref" href="#api.overview.figures.PHPUnit2_Framework.png" title="Figure 14.1. The five basic classes and interfaces in PHPUnit">Figure 14.1</a>
      shows the relationship of the five basic classes and interfaces
      in PHPUnit: <code class="literal">PHPUnit2_Framework_Assert</code>,
      <code class="literal">PHPUnit2_Framework_Test</code>,
      <code class="literal">PHPUnit2_Framework_TestCase</code>,
      <code class="literal">PHPUnit2_Framework_TestSuite</code>, and
      <code class="literal">PHPUnit2_Framework_TestResult</code>.
    </p><div class="figure"><a id="api.overview.figures.PHPUnit2_Framework.png"></a><p class="title"><strong>Figure 14.1. The five basic classes and interfaces in PHPUnit</strong></p><div class="figure-contents"><div><img src="figures/PHPUnit2_Framework.png" alt="The five basic classes and interfaces in PHPUnit" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.assert"></a>PHPUnit2_Framework_Assert</h2></div></div></div><a id="idm140466932268368" class="indexterm"></a><p>
      <a id="idm140466932267360" class="indexterm"></a>
      <a id="idm140466932266608" class="indexterm"></a>

      Most test cases written for PHPUnit are derived indirectly from the class
      <code class="literal">PHPUnit2_Framework_Assert</code>, which contains methods for
      automatically checking values and reporting discrepancies. The methods
      are declared static, so you can write design-by-contract style
      assertions in your methods and have them reported through PHPUnit
      (<a class="xref" href="#api.assert.examples.Sample.php" title="Example 14.1: Design-by-Contract Style Assertions">Example 14.1</a>).
    </p><div class="example"><a id="api.assert.examples.Sample.php"></a><p class="title"><strong>Example 14.1: Design-by-Contract Style Assertions</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/Assert.php';

class Sample {
    public function aSampleMethod($object) {
        PHPUnit2_Framework_Assert::assertNotNull($object);
    }
}

$sample = new Sample;
$sample-&gt;aSampleMethod(NULL);
?&gt;</pre><pre class="screen">Fatal error: Uncaught exception 'PHPUnit2_Framework_AssertionFailedError'
with message 'expected: &lt;NOT NULL&gt; but was: &lt;NULL&gt;'</pre></div></div><br class="example-break" /><p>
      Most of the time, though, you'll be checking the assertions inside of
      tests.
    </p><p>
      There are two variants of each of the assertion methods: one takes a
      message to be displayed with the error as a parameter, and one does not.
      The optional message is typically displayed when a failure is displayed,
      which can make debugging easier.
    </p><div class="example"><a id="api.assert.examples.MessageTest.php"></a><p class="title"><strong>Example 14.2: Using assertions with messages</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestCase.php';

class MessageTest extends PHPUnit2_Framework_TestCase {
    public function testMessage() {
        $this-&gt;assertTrue(FALSE, 'This is a custom message.');
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      The following example shows the output you get when you run the
      <code class="literal">testMessage()</code> test from
      <a class="xref" href="#api.assert.examples.MessageTest.php" title="Example 14.2: Using assertions with messages">Example 14.2</a>, using
      assertions with messages:
    </p><pre class="screen"><strong class="userinput"><code>phpunit MessageTest.php</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

F

Time: 0.102507
There was 1 failure:
1) testMessage(MessageTest)
This is a custom message.

FAILURES!!!
Tests run: 1, Failures: 1, Errors: 0, Incomplete Tests: 0.</pre><p>
      <a class="xref" href="#api.assert.tables.assertions" title="Table 14.1. Assertions">Table 14.1</a> shows all the varieties
      of assertions.
    </p><div class="table"><a id="api.assert.tables.assertions"></a><p class="title"><strong>Table 14.1. Assertions</strong></p><div class="table-contents"><table class="table" summary="Assertions" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Assertion</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void assertTrue(bool $condition)</code></td><td align="left">Reports an error if <code class="literal">$condition</code> is <code class="literal">FALSE</code>.</td></tr><tr><td align="left"><code class="literal">void assertTrue(bool $condition, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$condition</code> is <code class="literal">FALSE</code>.</td></tr><tr><td align="left"><code class="literal">void assertFalse(bool $condition)</code></td><td align="left">Reports an error if <code class="literal">$condition</code> is <code class="literal">TRUE</code>.</td></tr><tr><td align="left"><code class="literal">void assertFalse(bool $condition, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$condition</code> is <code class="literal">TRUE</code>.</td></tr><tr><td align="left"><code class="literal">void assertNull(mixed $variable)</code></td><td align="left">Reports an error if <code class="literal">$variable</code> is not <code class="literal">NULL</code>.</td></tr><tr><td align="left"><code class="literal">void assertNull(mixed $variable, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$variable</code> is not <code class="literal">NULL</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotNull(mixed $variable)</code></td><td align="left">Reports an error if <code class="literal">$variable</code> is <code class="literal">NULL</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotNull(mixed $variable, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$variable</code> is <code class="literal">NULL</code>.</td></tr><tr><td align="left"><code class="literal">void assertSame(object $expected, object $actual)</code></td><td align="left">Reports an error if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> do not reference the same object.</td></tr><tr><td align="left"><code class="literal">void assertSame(object $expected, object $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> do not reference the same object.</td></tr><tr><td align="left"><code class="literal">void assertSame(mixed $expected, mixed $actual)</code></td><td align="left">Reports an error if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> do not have the same type and value.</td></tr><tr><td align="left"><code class="literal">void assertSame(mixed $expected, mixed $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> do not have the same type and value.</td></tr><tr><td align="left"><code class="literal">void assertNotSame(object $expected, object $actual)</code></td><td align="left">Reports an error if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> reference the same object.</td></tr><tr><td align="left"><code class="literal">void assertNotSame(object $expected, object $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> reference the same object.</td></tr><tr><td align="left"><code class="literal">void assertNotSame(mixed $expected, mixed $actual)</code></td><td align="left">Reports an error if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> have the same type and value.</td></tr><tr><td align="left"><code class="literal">void assertNotSame(mixed $expected, mixed $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> have the same type and value.</td></tr><tr><td align="left"><code class="literal">void assertEquals(array $expected, array $actual)</code></td><td align="left">Reports an error if the two arrays <code class="literal">$expected</code> and <code class="literal">$actual</code> are not equal.</td></tr><tr><td align="left"><code class="literal">void assertEquals(array $expected, array $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two arrays <code class="literal">$expected</code> and <code class="literal">$actual</code> are not equal.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(array $expected, array $actual)</code></td><td align="left">Reports an error if the two arrays <code class="literal">$expected</code> and <code class="literal">$actual</code> are equal.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(array $expected, array $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two arrays <code class="literal">$expected</code> and <code class="literal">$actual</code> are equal.</td></tr><tr><td align="left"><code class="literal">void assertEquals(float $expected, float $actual, '', float $delta = 0)</code></td><td align="left">Reports an error if the two floats <code class="literal">$expected</code> and <code class="literal">$actual</code> are not within <code class="literal">$delta</code> of each other.</td></tr><tr><td align="left"><code class="literal">void assertEquals(float $expected, float $actual, string $message, float $delta = 0)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two floats <code class="literal">$expected</code> and <code class="literal">$actual</code> are not within <code class="literal">$delta</code> of each other.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(float $expected, float $actual, '', float $delta = 0)</code></td><td align="left">Reports an error if the two floats <code class="literal">$expected</code> and <code class="literal">$actual</code> are within <code class="literal">$delta</code> of each other.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(float $expected, float $actual, string $message, float $delta = 0)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two floats <code class="literal">$expected</code> and <code class="literal">$actual</code> are within <code class="literal">$delta</code> of each other.</td></tr><tr><td align="left"><code class="literal">void assertEquals(string $expected, string $actual)</code></td><td align="left">Reports an error if the two strings <code class="literal">$expected</code> and <code class="literal">$actual</code> are not equal. The error is reported as the delta between the two strings.</td></tr><tr><td align="left"><code class="literal">void assertEquals(string $expected, string $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two strings <code class="literal">$expected</code> and <code class="literal">$actual</code> are not equal. The error is reported as the delta between the two strings.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(string $expected, string $actual)</code></td><td align="left">Reports an error if the two strings <code class="literal">$expected</code> and <code class="literal">$actual</code> are equal.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(string $expected, string $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two strings <code class="literal">$expected</code> and <code class="literal">$actual</code> are equal.</td></tr><tr><td align="left"><code class="literal">void assertEquals(mixed $expected, mixed $actual)</code></td><td align="left">Reports an error if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> are not equal.</td></tr><tr><td align="left"><code class="literal">void assertEquals(mixed $expected, mixed $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> are not equal.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(mixed $expected, mixed $actual)</code></td><td align="left">Reports an error if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> are equal.</td></tr><tr><td align="left"><code class="literal">void assertNotEquals(mixed $expected, mixed $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the two variables <code class="literal">$expected</code> and <code class="literal">$actual</code> are equal.</td></tr><tr><td align="left"><code class="literal">void assertContains(mixed $needle, array $haystack)</code></td><td align="left">Reports an error if <code class="literal">$needle</code> is not an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertContains(mixed $needle, array $haystack, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$needle</code> is not an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotContains(mixed $needle, array $haystack)</code></td><td align="left">Reports an error if <code class="literal">$needle</code> is an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotContains(mixed $needle, array $haystack, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$needle</code> is an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertContains(mixed $needle, Iterator $haystack)</code></td><td align="left">Reports an error if <code class="literal">$needle</code> is not an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertContains(mixed $needle, Iterator $haystack, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$needle</code> is not an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotContains(mixed $needle, Iterator $haystack)</code></td><td align="left">Reports an error if <code class="literal">$needle</code> is an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotContains(mixed $needle, Iterator $haystack, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$needle</code> is an element of <code class="literal">$haystack</code>.</td></tr><tr><td align="left"><code class="literal">void assertRegExp(string $pattern, string $string)</code></td><td align="left">Reports an error if <code class="literal">$string</code> does not match the regular expression <code class="literal">$pattern</code>.</td></tr><tr><td align="left"><code class="literal">void assertRegExp(string $pattern, string $string, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$string</code> does not match the regular expression <code class="literal">$pattern</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotRegExp(string $pattern, string $string)</code></td><td align="left">Reports an error if <code class="literal">$string</code> matches the regular expression <code class="literal">$pattern</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotRegExp(string $pattern, string $string, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if <code class="literal">$string</code> matches the regular expression <code class="literal">$pattern</code>.</td></tr><tr><td align="left"><code class="literal">void assertType(string $expected, mixed $actual)</code></td><td align="left">Reports an error if the variable <code class="literal">$actual</code> is not of type <code class="literal">$expected</code>.</td></tr><tr><td align="left"><code class="literal">void assertType(string $expected, mixed $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the variable <code class="literal">$actual</code> is not of type <code class="literal">$expected</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotType(string $expected, mixed $actual)</code></td><td align="left">Reports an error if the variable <code class="literal">$actual</code> is of type <code class="literal">$expected</code>.</td></tr><tr><td align="left"><code class="literal">void assertNotType(string $expected, mixed $actual, string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code> if the variable <code class="literal">$actual</code> is of type <code class="literal">$expected</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      You may find that you need other assertions than these to compare
      objects specific to your project. Create your own <code class="literal">Assert</code>
      class to contain these assertions to simplify your tests.
    </p><p>
      Failing assertions all call a single bottleneck method,
      <code class="literal">fail(string $message)</code>, which throws an
      <code class="literal">PHPUnit2_Framework_AssertionFailedError</code>. There is
      also a variant which takes no parameters. Call <code class="literal">fail()</code>
      explicitly when your test encounters an error. The test for an expected
      exception is an example.
      <a class="xref" href="#api.assert.tables.bottleneck-methods" title="Table 14.2. Bottleneck Methods">Table 14.2</a> lists the
      bottlenext methods in PHPUnit.
    </p><div class="table"><a id="api.assert.tables.bottleneck-methods"></a><p class="title"><strong>Table 14.2. Bottleneck Methods</strong></p><div class="table-contents"><table class="table" summary="Bottleneck Methods" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void fail()</code></td><td align="left">Reports an error.</td></tr><tr><td align="left"><code class="literal">void fail(string $message)</code></td><td align="left">Reports an error identified by <code class="literal">$message</code>.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.test"></a>PHPUnit2_Framework_Test</h2></div></div></div><a id="idm140466932085664" class="indexterm"></a><p>
      <code class="literal">PHPUnit2_Framework_Test</code> is the generic interface
      used by all objects that can act as tests. Implementors may represent
      one or more tests. The two methods are shown in
      <a class="xref" href="#api.test.tables.implementor-methods" title="Table 14.3. Implementor Methods">Table 14.3</a>.
    </p><div class="table"><a id="api.test.tables.implementor-methods"></a><p class="title"><strong>Table 14.3. Implementor Methods</strong></p><div class="table-contents"><table class="table" summary="Implementor Methods" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">int countTestCases()</code></td><td align="left">Return the number of tests.</td></tr><tr><td align="left"><code class="literal">void run(PHPUnit2_Framework_TestResult $result)</code></td><td align="left">Run the tests and report the results on <code class="literal">$result</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      <code class="literal">PHPUnit2_Framework_TestCase</code> and
      <code class="literal">PHPUnit2_Framework_TestSuite</code> are the two most
      prominent implementors of <code class="literal">PHPUnit2_Framework_Test</code>.
      You can implement <code class="literal">PHPUnit2_Framework_Test</code> yourself.
      The interface is kept small intentionally so it will be easy to
      implement.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.testcase"></a>PHPUnit2_Framework_TestCase</h2></div></div></div><a id="idm140466932071296" class="indexterm"></a><p>
      Your test-case classes will inherit from
      <code class="literal">PHPUnit2_Framework_TestCase</code>. Most of the time, you
      will run tests from automatically created test suites. In this case,
      each of your tests should be represented by a method named
      <code class="literal">test*</code> (by convention).
    </p><p>
      <code class="literal">PHPUnit2_Framework_TestCase</code> implements
      <code class="literal">PHPUnit2_Framework_Test::countTestCases()</code> so that it
      always returns <code class="literal">1</code>. The implementation of
      <code class="literal">PHPUnit2_Framework_Test::run(PHPUnit2_Framework_TestResult $result)</code>
      in this class runs <code class="literal">setUp()</code>, runs the test method,
      and then runs <code class="literal">tearDown()</code>, reporting any exceptions
      to the <code class="literal">PHPUnit2_Framework_TestResult</code>.
    </p><p>
      <a class="xref" href="#api.testcase.tables.external-protocols" title="Table 14.4. TestCase external protocols">Table 14.4</a> shows the
      external protocol implemented by <code class="literal">PHPUnit2_Framework_TestCase</code>.
    </p><div class="table"><a id="api.testcase.tables.external-protocols"></a><p class="title"><strong>Table 14.4. TestCase external protocols</strong></p><div class="table-contents"><table class="table" summary="TestCase external protocols" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">__construct()</code></td><td align="left">Creates a test case.</td></tr><tr><td align="left"><code class="literal">__construct(string $name)</code></td><td align="left">Creates a named test case. Names are used to print the test case and often as the name of the test method to be run by reflection.</td></tr><tr><td align="left"><code class="literal">string getName()</code></td><td align="left">Return the name of the test case.</td></tr><tr><td align="left"><code class="literal">void setName($name)</code></td><td align="left">Set the name of the test case.</td></tr><tr><td align="left"><code class="literal">PHPUnit2_Framework_TestResult run(PHPUnit2_Framework_TestResult $result)</code></td><td align="left">Convenience method to run the test case and report it in <code class="literal">$result</code>.</td></tr><tr><td align="left"><code class="literal">void runTest()</code></td><td align="left">Override with a testing method if you do not want the testing method to be invoked by reflection.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      There are two template methods -- <code class="literal">setUp()</code> and
      <code class="literal">tearDown()</code> -- you can override to create and
      dispose of the objects against which you are going to test.
      <a class="xref" href="#api.testcase.tables.template-methods" title="Table 14.5. Template Methods">Table 14.5</a> shows
      these methods.
    </p><div class="table"><a id="api.testcase.tables.template-methods"></a><p class="title"><strong>Table 14.5. Template Methods</strong></p><div class="table-contents"><table class="table" summary="Template Methods" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void setUp()</code></td><td align="left">Override to create objects against which to test. Each test that runs will be run in its own test case, and <code class="literal">setUp()</code> will be called separately for each one.</td></tr><tr><td align="left"><code class="literal">void tearDown()</code></td><td align="left">Override to dispose of objects no longer needed once the test has finished. In general, you only need to explicitly dispose of external resources (files or sockets, for example) in <code class="literal">tearDown()</code>.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.testsuite"></a>PHPUnit2_Framework_TestSuite</h2></div></div></div><a id="idm140466932035792" class="indexterm"></a><p>
      A <code class="literal">PHPUnit2_Framework_TestSuite</code> is a composite of
      <code class="literal">PHPUnit2_Framework_Test</code>s. At its simplest, it
      contains a bunch of test cases, all of which are run when the suite is
      run. Since it is a composite, however, a suite can contain suites which
      can contain suites and so on, making it easy to combine tests from
      various sources and run them together.
    </p><p>
      In addition to the <code class="literal">PHPUnit2_Framework_Test</code> protocol --
      <code class="literal">run(PHPUnit2_Framework_TestResult $result)</code> and
      <code class="literal">countTestCases()</code> -- <code class="literal">PHPUnit2_Framework_TestSuite</code>
      contains protocol to create named or unnamed instances.
      <a class="xref" href="#api.testsuite.tables.creating-instances" title="Table 14.6. Creating named or unnamed instances">Table 14.6</a> shows the
      instance creation protocol for <code class="literal">PHPUnit2_Framework_TestSuite</code>.
    </p><div class="table"><a id="api.testsuite.tables.creating-instances"></a><p class="title"><strong>Table 14.6. Creating named or unnamed instances</strong></p><div class="table-contents"><table class="table" summary="Creating named or unnamed instances" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">__construct()</code></td><td align="left">Return an empty test suite.</td></tr><tr><td align="left"><code class="literal">__construct(string $theClass)</code></td><td align="left">Return a test suite containing an instance of the class named <code class="literal">$theClass</code> for each method in the class named <code class="literal">test*</code>. If no class of name <code class="literal">$theClass</code> exists an empty test suite named <code class="literal">$theClass</code> is returned.</td></tr><tr><td align="left"><code class="literal">__construct(string $theClass, string $name)</code></td><td align="left">Return a test suite named <code class="literal">$name</code> containing an instance of the class named <code class="literal">$theClass</code> for each method in the class named <code class="literal">test*</code>.</td></tr><tr><td align="left"><code class="literal">__construct(ReflectionClass $theClass)</code></td><td align="left">Return a test suite containing an instance of the class represented by <code class="literal">$theClass</code> for each method in the class named <code class="literal">test*</code>.</td></tr><tr><td align="left"><code class="literal">__construct(ReflectionClass $theClass, $name)</code></td><td align="left">Return a test suite named <code class="literal">$name</code> containing an instance of the class represented by <code class="literal">$theClass</code> for each method in the class named <code class="literal">test*</code>.</td></tr><tr><td align="left"><code class="literal">string getName()</code></td><td align="left">Return the name of the test suite.</td></tr><tr><td align="left"><code class="literal">void setName(string $name)</code></td><td align="left">Set the name of the test suite.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      <code class="literal">PHPUnit2_Framework_TestSuite</code> also contains protocol
      for adding and retrieving <code class="literal">PHPUnit2_Framework_Test</code>s,
      as shown in <a class="xref" href="#api.testsuite.tables.protocol" title="Table 14.7. Protocol for adding and retrieving tests">Table 14.7</a>.
    </p><div class="table"><a id="api.testsuite.tables.protocol"></a><p class="title"><strong>Table 14.7. Protocol for adding and retrieving tests</strong></p><div class="table-contents"><table class="table" summary="Protocol for adding and retrieving tests" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void addTest(PHPUnit2_Framework_Test $test)</code></td><td align="left">Add <code class="literal">$test</code> to the suite.</td></tr><tr><td align="left"><code class="literal">void addTestFile(string $filename)</code></td><td align="left">Add the tests that are defined in the class(es) of a given sourcefile to the suite.</td></tr><tr><td align="left"><code class="literal">void addTestFiles(array $filenames)</code></td><td align="left">Add the tests that are defined in the classes of the given sourcefiles to the suite.</td></tr><tr><td align="left"><code class="literal">int testCount()</code></td><td align="left">Return the number of tests directly (not recursively) in this suite.</td></tr><tr><td align="left"><code class="literal">PHPUnit2_Framework_Test[] tests()</code></td><td align="left">Return the tests directly in this suite.</td></tr><tr><td align="left"><code class="literal">PHPUnit2_Framework_Test testAt(int $index)</code></td><td align="left">Return the test at the <code class="literal">$index</code>.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      <a class="xref" href="#api.testsuite.examples.TestSuite-example.php" title="Example 14.3: Creating and running a test suite">Example 14.3</a> shows
      how to create and run a test suite.
    </p><div class="example"><a id="api.testsuite.examples.TestSuite-example.php"></a><p class="title"><strong>Example 14.3: Creating and running a test suite</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestSuite.php';

require_once 'ArrayTest.php';

// Create a test suite that contains the tests
// from the ArrayTest class.
$suite = new PHPUnit2_Framework_TestSuite('ArrayTest');

// Run the tests.
$suite-&gt;run();
?&gt;</pre></div></div><br class="example-break" /><p>
      For an example on how to use <code class="literal">PHPUnit2_Framework_TestSuite</code>
      to hierarchically compose test cases let us look at PHPUnit's own test
      suite.
    </p><p>
      <a class="xref" href="#api.testsuite.examples.AllTests.php" title="Example 14.4: The AllTests class">Example 14.4</a> shows a cut-down
      version of <code class="filename">Tests/AllTests.php</code>,
      <a class="xref" href="#api.testsuite.examples.Framework_AllTests.php" title="Example 14.5: The Framework_AllTests class">Example 14.5</a> a
      cut-down version of <code class="filename">Tests/Framework/AllTests.php</code>.
    </p><div class="example"><a id="api.testsuite.examples.AllTests.php"></a><p class="title"><strong>Example 14.4: The AllTests class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
if (!defined('PHPUnit2_MAIN_METHOD')) {
    define('PHPUnit2_MAIN_METHOD', 'AllTests::main');
}

require_once 'PHPUnit2/Framework/TestSuite.php';
require_once 'PHPUnit2/TextUI/TestRunner.php';

require_once 'Framework/AllTests.php';
// ...

class AllTests {
    public static function main() {
        PHPUnit2_TextUI_TestRunner::run(self::suite());
    }

    public static function suite() {
        $suite = new PHPUnit2_Framework_TestSuite('PHPUnit');

        $suite-&gt;addTest(Framework_AllTests::suite());
        // ...

        return $suite;
    }
}

if (PHPUnit2_MAIN_METHOD == 'AllTests::main') {
    AllTests::main();
}
?&gt;</pre></div></div><br class="example-break" /><div class="example"><a id="api.testsuite.examples.Framework_AllTests.php"></a><p class="title"><strong>Example 14.5: The Framework_AllTests class</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
if (!defined('PHPUnit2_MAIN_METHOD')) {
    define('PHPUnit2_MAIN_METHOD', 'Framework_AllTests::main');
}

require_once 'PHPUnit2/Framework/TestSuite.php';
require_once 'PHPUnit2/TextUI/TestRunner.php';

require_once 'Framework/AssertTest.php';
// ...

class Framework_AllTests {
    public static function main() {
        PHPUnit2_TextUI_TestRunner::run(self::suite());
    }

    public static function suite() {
        $suite = new PHPUnit2_Framework_TestSuite('PHPUnit Framework');

        $suite-&gt;addTestSuite('Framework_AssertTest');
        // ...

        return $suite;
    }
}

if (PHPUnit2_MAIN_METHOD == 'Framework_AllTests::main') {
    Framework_AllTests::main();
}
?&gt;</pre></div></div><br class="example-break" /><p>
      The <code class="literal">Framework_AssertTest</code> class is a standard test case
      that extends <code class="literal">PHPUnit2_Framework_TestCase</code>.
    </p><p>
      Running <code class="filename">Tests/AllTests.php</code> uses the TextUI
      test runner to run all tests while running
      <code class="filename">Tests/Framework/AllTests.php</code> runs only the tests
      for the <code class="literal">PHPUnit2_Framework_*</code> classes.
    </p><p>
      This example shows the PHPUnit test suite running:
    </p><pre class="screen"><strong class="userinput"><code>php AllTests.php</code></strong>
PHPUnit 2.3.0 by Sebastian Bergmann.

.........................................
.........................................
.......

Time: 4.642600

OK (89 tests)</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.testresult"></a>PHPUnit2_Framework_TestResult</h2></div></div></div><a id="idm140466931972224" class="indexterm"></a><p>
      While you are running all these tests, you need somewhere to store all
      the results: how many tests ran, which failed, and how long they took.
      <code class="literal">PHPUnit2_Framework_TestResult</code> collects these results.
      A single <code class="literal">PHPUnit2_Framework_TestResult</code> is passed
      around the whole tree of tests; when a test runs or fails, the fact is
      noted in the <code class="literal">PHPUnit2_Framework_TestResult</code>. At the
      end of the run, <code class="literal">PHPUnit2_Framework_TestResult</code>
      contains a summary of all the tests.
    </p><p>
      <code class="literal">PHPUnit2_Framework_TestResult</code> is also a subject than
      can be observed by other objects wanting to report test progress. For
      example, a graphical test runner might observe the
      <code class="literal">PHPUnit2_Framework_TestResult</code> and update a progress
      bar every time a test starts.
    </p><p>
      <a class="xref" href="#api.testresult.tables.external-protocols" title="Table 14.8. TestResult external protocols">Table 14.8</a> summarizes
      the external protocols of <code class="literal">PHPUnit2_Framework_TestResult</code>.
    </p><div class="table"><a id="api.testresult.tables.external-protocols"></a><p class="title"><strong>Table 14.8. TestResult external protocols</strong></p><div class="table-contents"><table class="table" summary="TestResult external protocols" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void addError(PHPUnit2_Framework_Test $test, Exception $e)</code></td><td align="left">Record that running <code class="literal">$test</code> caused <code class="literal">$e</code> to be thrown unexpectedly.</td></tr><tr><td align="left"><code class="literal">void addFailure(PHPUnit2_Framework_Test $test, PHPUnit2_Framework_AssertionFailedError $e)</code></td><td align="left">Record that running <code class="literal">$test</code> caused <code class="literal">$e</code> to be thrown unexpectedly.</td></tr><tr><td align="left"><code class="literal">PHPUnit2_Framework_TestFailure[] errors()</code></td><td align="left">Return the errors recorded.</td></tr><tr><td align="left"><code class="literal">PHPUnit2_Framework_TestFailure[] failures()</code></td><td align="left">Return the failures recorded.</td></tr><tr><td align="left"><code class="literal">PHPUnit2_Framework_TestFailure[] notImplemented()</code></td><td align="left">Return the incomplete test cases recorded.</td></tr><tr><td align="left"><code class="literal">int errorCount()</code></td><td align="left">Return the number of errors.</td></tr><tr><td align="left"><code class="literal">int failureCount()</code></td><td align="left">Return the number of failures.</td></tr><tr><td align="left"><code class="literal">int notImplementedCount()</code></td><td align="left">Return the number of incomplete test cases.</td></tr><tr><td align="left"><code class="literal">int runCount()</code></td><td align="left">Return the total number of test cases run.</td></tr><tr><td align="left"><code class="literal">boolean wasSuccessful()</code></td><td align="left">Return whether or not all tests ran successfully.</td></tr><tr><td align="left"><code class="literal">boolean allCompletlyImplemented()</code></td><td align="left">Return whether or not all tests were completely implemented.</td></tr><tr><td align="left"><code class="literal">void collectCodeCoverageInformation(bool $flag)</code></td><td align="left">Enables or disables the collection of Code Coverage information.</td></tr><tr><td align="left"><code class="literal">array getCodeCoverageInformation()</code></td><td align="left">Return the code coverage information collected.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      <a id="idm140466931937760" class="indexterm"></a>
      <a id="idm140466931937008" class="indexterm"></a>

      If you want to register as an observer of a
      <code class="literal">PHPUnit2_Framework_TestResult</code>, you need to implement
      <code class="literal">PHPUnit2_Framework_TestListener</code>. To register, call
      <code class="literal">addListener()</code>, as shown in
      <a class="xref" href="#api.testresult.tables.testresult-testlistener" title="Table 14.9. TestResult and TestListener">Table 14.9</a>.
    </p><div class="table"><a id="api.testresult.tables.testresult-testlistener"></a><p class="title"><strong>Table 14.9. TestResult and TestListener</strong></p><div class="table-contents"><table class="table" summary="TestResult and TestListener" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void addListener(PHPUnit2_Framework_TestListener $listener)</code></td><td align="left">Register <code class="literal">$listener</code> to receive updates as results are recorded in the test result.</td></tr><tr><td align="left"><code class="literal">void removeListener(PHPUnit2_Framework_TestListener $listener)</code></td><td align="left">Unregister <code class="literal">$listener</code> from receiving updates.</td></tr></tbody></table></div></div><br class="table-break" /><p>
      <a class="xref" href="#api.testresult.tables.testlistener" title="Table 14.10. TestListener Callbacks">Table 14.10</a> shows the methods
      that test listeners implement; also see
      <a class="xref" href="#extending-phpunit.examples.SimpleTestListener.php" title="Example 15.3: A simple test listener">Example 15.3</a>.
    </p><div class="table"><a id="api.testresult.tables.testlistener"></a><p class="title"><strong>Table 14.10. TestListener Callbacks</strong></p><div class="table-contents"><table class="table" summary="TestListener Callbacks" border="1"><colgroup><col /><col /></colgroup><thead><tr><th align="left">Method</th><th align="left">Meaning</th></tr></thead><tbody><tr><td align="left"><code class="literal">void addError(PHPUnit2_Framework_Test $test, Exception $e)</code></td><td align="left"><code class="literal">$test</code> has thrown <code class="literal">$e</code>.</td></tr><tr><td align="left"><code class="literal">void addFailure(PHPUnit2_Framework_Test $test, PHPUnit2_Framework_AssertionFailedError $e)</code></td><td align="left"><code class="literal">$test</code> has failed an assertion, throwing a kind of <code class="literal">PHPUnit2_Framework_AssertionFailedError</code>.</td></tr><tr><td align="left"><code class="literal">void addIncompleteTest(PHPUnit2_Framework_Test $test, Exception $e)</code></td><td align="left"><code class="literal">$test</code> is an incomplete test.</td></tr><tr><td align="left"><code class="literal">void startTestSuite(PHPUnit2_Framework_TestSuite $suite)</code></td><td align="left"><code class="literal">$suite</code> is about to be run.</td></tr><tr><td align="left"><code class="literal">void endTestSuite(PHPUnit2_Framework_TestSuite $suite)</code></td><td align="left"><code class="literal">$suite</code> has finished running.</td></tr><tr><td align="left"><code class="literal">void startTest(PHPUnit2_Framework_Test $test)</code></td><td align="left"><code class="literal">$test</code> is about to be run.</td></tr><tr><td align="left"><code class="literal">void endTest(PHPUnit2_Framework_Test $test)</code></td><td align="left"><code class="literal">$test</code> has finished running.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="api.package-structure"></a>Package Structure</h2></div></div></div><p>
      Many of the classes mentioned so far in this book come from
      <code class="literal">PHPUnit2/Framework</code>. Here are all the packages in
      PHPUnit:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">PHPUnit2/Framework</code></p><p>
          The basic classes in PHPUnit.
        </p></li><li class="listitem"><p><code class="literal">PHPUnit2/Extensions</code></p><p>
          Extensions to the PHPUnit framework.
        </p></li><li class="listitem"><p><code class="literal">PHPUnit2/Runner</code></p><p>
          Abstract support for running tests.
        </p></li><li class="listitem"><p><code class="literal">PHPUnit2/TextUI</code></p><p>
          The text-based test runner.
        </p></li><li class="listitem"><p><code class="literal">PHPUnit2/Util</code></p><p>
          Utility classes used by the other packages.
        </p></li></ul></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="extending-phpunit"></a>Chapter 15. Extending PHPUnit</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    PHPUnit can be extended in various ways to make the writing of tests
    easier and customize the feedback you get from running tests. Here are
    common starting points to extend PHPUnit.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_TestCase"></a>Subclass PHPUnit2_Framework_TestCase</h2></div></div></div><p>
      <a id="idm140466931431504" class="indexterm"></a>

      Write utility methods in an abstract subclass of
      <code class="literal">PHPUnit2_Framework_TestCase</code> and derive your test case
      classes from that class. This is one of the easiest ways to extend
      PHPUnit.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.Assert"></a>Assert Classes</h2></div></div></div><p>
      <a id="idm140466931428304" class="indexterm"></a>
      <a id="idm140466931427520" class="indexterm"></a>

      Write your own class with assertions special to your purpose.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Extensions_TestDecorator"></a>Subclass PHPUnit2_Extensions_TestDecorator</h2></div></div></div><p>
      <a id="idm140466931424912" class="indexterm"></a>

      You can wrap test cases or test suites in a subclass of
      <code class="literal">PHPUnit2_Extensions_TestDecorator</code> and use the
      Decorator design pattern to perform some actions before and after the
      test runs.
    </p><p>
      <a id="idm140466931422784" class="indexterm"></a>
      <a id="idm140466931421952" class="indexterm"></a>

      PHPUnit ships with two concrete test decorators:
      <code class="literal">PHPUnit2_Extensions_RepeatedTest</code> and
      <code class="literal">PHPUnit2_Extensions_TestSetup</code>. The former is used to
      run a test repeatedly and only count it as a success if all iterations
      are successful. The latter was discussed in <a class="xref" href="#fixtures" title="Chapter 5. Fixtures">Chapter 5</a>.
    </p><p>
      <a class="xref" href="#extending-phpunit.examples.RepeatedTest.php" title="Example 15.1: The RepeatedTest Decorator">Example 15.1</a>
      shows a cut-down version of the <code class="literal">PHPUnit2_Extensions_RepeatedTest</code>
      test decorator that illustrates how to write your own test decorators.
    </p><div class="example"><a id="extending-phpunit.examples.RepeatedTest.php"></a><p class="title"><strong>Example 15.1: The RepeatedTest Decorator</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Extensions/TestDecorator.php';

class PHPUnit2_Extensions_RepeatedTest extends PHPUnit2_Extensions_TestDecorator {
    private $timesRepeat = 1;

    public function __construct(PHPUnit2_Framework_Test $test, $timesRepeat = 1) {
        parent::__construct($test);

        if (is_integer($timesRepeat) &amp;&amp;
            $timesRepeat &gt;= 0) {
            $this-&gt;timesRepeat = $timesRepeat;
        }
    }

    public function countTestCases() {
        return $this-&gt;timesRepeat * $this-&gt;test-&gt;countTestCases();
    }

    public function run($result = NULL) {
        if ($result === NULL) {
            $result = $this-&gt;createResult();
        }

        for ($i = 0; $i &lt; $this-&gt;timesRepeat &amp;&amp; !$result-&gt;shouldStop(); $i++) {
            $this-&gt;test-&gt;run($result);
        }

        return $result;
    }
}
?&gt;</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_Test"></a>Implement PHPUnit2_Framework_Test</h2></div></div></div><p>
      <a id="idm140466931412416" class="indexterm"></a>
      <a id="idm140466931411664" class="indexterm"></a>

      The <code class="literal">PHPUnit2_Framework_Test</code> interface is narrow and
      easy to implement. You can write an implementation of
      <code class="literal">PHPUnit2_Framework_Test</code> that is simpler than
      <code class="literal">PHPUnit2_Framework_TestCase</code> and that runs
      <span class="emphasis"><em>data-driven tests</em></span>, for instance.
    </p><p>
      <a class="xref" href="#extending-phpunit.examples.DataDrivenTest.php" title="Example 15.2: A data-driven test">Example 15.2</a>
      shows a data-driven test-case class that compares values from a file
      with Comma-Separated Values (CSV). Each line of such a file looks like
      <code class="literal">foo;bar</code>, where the first value is the one we expect
      and the second value is the actual one.
    </p><div class="example"><a id="extending-phpunit.examples.DataDrivenTest.php"></a><p class="title"><strong>Example 15.2: A data-driven test</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/Assert.php';
require_once 'PHPUnit2/Framework/Test.php';
require_once 'PHPUnit2/Framework/TestResult.php';

class DataDrivenTest implements PHPUnit2_Framework_Test {
    private $lines;

    public function __construct($dataFile) {
        $this-&gt;lines = file($dataFile);
    }

    public function countTestCases() {
        return sizeof($this-&gt;lines);
    }

    public function run($result = NULL) {
        if ($result === NULL) {
            $result = new PHPUnit2_Framework_TestResult;
        }

        $result-&gt;startTest($this);

        foreach ($this-&gt;lines as $line) {
            list($expected, $actual) = explode(';', $line);

            try {
                PHPUnit2_Framework_Assert::assertEquals(trim($expected), trim($actual));
            }

            catch (PHPUnit2_Framework_ComparisonFailure $e) {
                $result-&gt;addFailure($this, $e);
            }

            catch (Exception $e) {
                $result-&gt;addError($this, $e);
            }
        }

        $result-&gt;endTest($this);

        return $result;
    }
}

$test   = new DataDrivenTest('data_file.csv');
$result = $test-&gt;run();

$failures = $result-&gt;failures();
print $failures[0]-&gt;thrownException()-&gt;toString();
?&gt;</pre><pre class="screen">expected: &lt;foo&gt; but was: &lt;bar&gt;</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_TestResult"></a>Subclass PHPUnit2_Framework_TestResult</h2></div></div></div><p>
      <a id="idm140466931400896" class="indexterm"></a>

      By passing a special-purpose <code class="literal">PHPUnit2_Framework_TestResult</code>
      object to the <code class="literal">run()</code> method, you can change the way
      tests are run and what result data gets collected.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_TestListener"></a>Implement PHPUnit2_Framework_TestListener</h2></div></div></div><p>
      <a id="idm140466931396848" class="indexterm"></a>
      <a id="idm140466931396016" class="indexterm"></a>

      You do not necessarily need to write a whole subclass of
      <code class="literal">PHPUnit2_Framework_TestResult</code> in order to customize
      it. Most of the time, it will suffice to implement a new
      <code class="literal">PHPUnit2_Framework_TestListener</code>
      (see <a class="xref" href="#api.testresult.tables.testlistener" title="Table 14.10. TestListener Callbacks">Table 14.10</a>) and attach
      it to the <code class="literal">PHPUnit2_Framework_TestResult</code> object, before
      running the tests.
    </p><p>
      <a class="xref" href="#extending-phpunit.examples.SimpleTestListener.php" title="Example 15.3: A simple test listener">Example 15.3</a>
      shows a simple implementation of the <code class="literal">PHPUnit2_Framework_TestListener</code>
      interface.
    </p><div class="example"><a id="extending-phpunit.examples.SimpleTestListener.php"></a><p class="title"><strong>Example 15.3: A simple test listener</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestListener.php';

class SimpleTestListener
implements PHPUnit2_Framework_TestListener {
  public function
  addError(PHPUnit2_Framework_Test $test, Exception $e) {
    printf(
      "Error while running test '%s'.\n",
      $test-&gt;getName()
    );
  }

  public function
  addFailure(PHPUnit2_Framework_Test $test,
             PHPUnit2_Framework_AssertionFailedError $e) {
    printf(
      "Test '%s' failed.\n",
      $test-&gt;getName()
    );
  }

  public function
  addIncompleteTest(PHPUnit2_Framework_Test $test,
                    Exception $e) {
    printf(
      "Test '%s' is incomplete.\n",
      $test-&gt;getName()
    );
  }

  public function startTest(PHPUnit2_Framework_Test $test) {
    printf(
      "Test '%s' started.\n",
      $test-&gt;getName()
    );
  }

  public function endTest(PHPUnit2_Framework_Test $test) {
    printf(
      "Test '%s' ended.\n",
      $test-&gt;getName()
    );
  }

  public function
  startTestSuite(PHPUnit2_Framework_TestSuite $suite) {
    printf(
      "TestSuite '%s' started.\n",
      $suite-&gt;getName()
    );
  }

  public function
  endTestSuite(PHPUnit2_Framework_TestSuite $suite) {
    printf(
      "TestSuite '%s' ended.\n",
      $suite-&gt;getName()
    );
  }
}
?&gt;</pre></div></div><br class="example-break" /><p>
      <a id="idm140466931388240" class="indexterm"></a>
      <a id="idm140466931387408" class="indexterm"></a>

      <a class="xref" href="#extending-phpunit.examples.SimpleTestListener-example.php" title="Example 15.4: Running and observing a test suite">Example 15.4</a>
      shows how to run and observe a test suite.
    </p><div class="example"><a id="extending-phpunit.examples.SimpleTestListener-example.php"></a><p class="title"><strong>Example 15.4: Running and observing a test suite</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestResult.php';
require_once 'PHPUnit2/Framework/TestSuite.php';

require_once 'ArrayTest.php';
require_once 'SimpleTestListener.php';

// Create a test suite that contains the tests
// from the ArrayTest class.
$suite = new PHPUnit2_Framework_TestSuite('ArrayTest');

// Create a test result and attach a SimpleTestListener
// object as an observer to it.
$result = new PHPUnit2_Framework_TestResult;
$result-&gt;addListener(new SimpleTestListener);

// Run the tests.
$suite-&gt;run($result);
?&gt;</pre><pre class="screen">TestSuite 'ArrayTest' started.
Test 'testNewArrayIsEmpty' started.
Test 'testNewArrayIsEmpty' ended.
Test 'testArrayContainsAnElement' started.
Test 'testArrayContainsAnElement' ended.
TestSuite 'ArrayTest' ended.</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.TestRunner"></a>New Test Runner</h2></div></div></div><p>
      If you need different feedback from the test execution, write your own
      test runner, interactive or not. The abstract
      <code class="literal">PHPUnit2_Runner_BaseTestRunner</code> class, which the
      <code class="literal">PHPUnit2_TextUI_TestRunner</code> class (the PHPUnit
      command-line test runner) inherits from, can be a starting point for
      this.
    </p></div></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="appendixes.phpunit1"></a>Appendix A. PHPUnit for PHP 4</h1></div></div></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    There is a release series of PHPUnit that works with PHP 4 and does not
    require PHP 5. Due to PHP 4's limited object model, PHPUnit for PHP 4 is
    not a complete port of JUnit as PHPUnit for PHP 5 is. It also lacks
    certain features of PHPUnit for PHP 5, such as code-coverage analysis.
  </p><p>
    The following command line shows how to install PHPUnit for PHP 4 using
    the PEAR Installer:
  </p><pre class="screen"><strong class="userinput"><code>pear install -f http://pear.phpunit.de/get/PHPUnit-1.3.3.tgz</code></strong></pre><p>
    A test-case class that is used with PHPUnit for PHP 4 is similar
    to one that is used with PHPUnit for PHP 5. The essential difference is
    that such a class extends <code class="literal">PHPUnit_TestCase</code>
    (which itself extends <code class="literal">PHPUnit_Assert</code>, the class that
    provides the assertion methods).
  </p><p>
    <a class="xref" href="#appendixes.phpunit1.examples.ArrayTest.php" title="Example A.1: Writing a test case for PHPUnit 1.x">Example A.1</a>
    shows a version of the <code class="literal">ArrayTest</code> test case that can
    be used with PHPUnit for PHP 4.
  </p><div class="example"><a id="appendixes.phpunit1.examples.ArrayTest.php"></a><p class="title"><strong>Example A.1: Writing a test case for PHPUnit 1.x</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit/TestCase.php';

class ArrayTest extends PHPUnit_TestCase
{
    var $_fixture;

    function setUp()
    {
        $this-&gt;_fixture = array();
    }

    function testNewArrayIsEmpty()
    {
        $this-&gt;assertEquals(0, sizeof($this-&gt;_fixture));
    }

    function testArrayContainsAnElement()
    {
        $this-&gt;_fixture[] = 'Element';
        $this-&gt;assertEquals(1, sizeof($this-&gt;_fixture));
    }
}
?&gt;</pre></div></div><br class="example-break" /><p>
    PHPUnit for PHP 4 does not provide a TextUI test runner. The most
    commonly used way to run tests with PHPUnit for PHP 4 is to write a
    test suite and run it manually, as shown in
    <a class="xref" href="#appendixes.phpunit1.examples.suite.php" title="Example A.2: Running a test case with PHPUnit 1.x">Example A.2</a>.
  </p><div class="example"><a id="appendixes.phpunit1.examples.suite.php"></a><p class="title"><strong>Example A.2: Running a test case with PHPUnit 1.x</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'ArrayTest.php';
require_once 'PHPUnit.php';

$suite  = new PHPUnit_TestSuite('ArrayTest');
$result = PHPUnit::run($suite);

print $result-&gt;toString();
?&gt;</pre><pre class="screen">TestCase arraytest-&gt;testnewarrayisempty() passed
TestCase arraytest-&gt;testarraycontainsanelement() passed</pre></div></div><br class="example-break" /><p>
    <a class="xref" href="#appendixes.phpunit1.figures.PHPUnit-Gtk.png" title="Figure A.1. The PHP-GTK Test Runner">Figure A.1</a> shows the
    one feature that PHPUnit for PHP 4 has that PHPUnit for PHP 5 does not
    yet have: a test runner with a graphical user interface based on
    PHP-GTK.
  </p><div class="figure"><a id="appendixes.phpunit1.figures.PHPUnit-Gtk.png"></a><p class="title"><strong>Figure A.1. The PHP-GTK Test Runner</strong></p><div class="figure-contents"><div><img src="figures/PHPUnit-Gtk.png" alt="The PHP-GTK Test Runner" /></div></div></div><br class="figure-break" /></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="appendixes.index"></a>Appendix B. Index</h1></div></div></div><div class="index"><div class="titlepage"><div><div><h2 class="title"><a id="appendixes.index.index"></a></h2></div></div></div><div xmlns:xlink="http://www.w3.org/1999/xlink" class="index"><div class="indexdiv"><h3>A</h3><dl><dt id="ientry-idm140466933231840">Agile Documentation, <a class="indexterm" href="#textui">The Command-Line Test Runner</a>, <a class="indexterm" href="#other-uses-for-tests.agile-documentation">Agile Documentation</a></dt><dt id="ientry-idm140466933454000">Assertions, <a class="indexterm" href="#automating-tests">Automating Tests</a>, <a class="indexterm" href="#api.assert">PHPUnit2_Framework_Assert</a>, <a class="indexterm" href="#extending-phpunit.Assert">Assert Classes</a></dt><dt id="ientry-idm140466932688912">Automated Documentation, <a class="indexterm" href="#other-uses-for-tests.agile-documentation">Agile Documentation</a></dt><dt id="ientry-idm140466933450384">Automated Test, <a class="indexterm" href="#automating-tests">Automating Tests</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt id="ientry-idm140466933236384">Code-Coverage, <a class="indexterm" href="#textui">The Command-Line Test Runner</a>, <a class="indexterm" href="#code-coverage-analysis">Code-Coverage Analysis</a>, <a class="indexterm" href="#phing.formatting-feedback">Formatting Feedback</a></dt><dt id="ientry-idm140466932416096">Collecting Parameter, <a class="indexterm" href="#implementation">PHPUnit's Implementation</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt id="ientry-idm140466931411664">Data-Driven Tests, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_Test">Implement PHPUnit2_Framework_Test</a></dt><dt id="ientry-idm140466932963568">Design-by-Contract, <a class="indexterm" href="#test-first-programming">Test-First Programming</a>, <a class="indexterm" href="#api.assert">PHPUnit2_Framework_Assert</a></dt><dt id="ientry-idm140466932678448">Documenting Assumptions, <a class="indexterm" href="#other-uses-for-tests.agile-documentation">Agile Documentation</a></dt></dl></div><div class="indexdiv"><h3>E</h3><dl><dt id="ientry-idm140466933252448">Error, <a class="indexterm" href="#textui">The Command-Line Test Runner</a></dt><dt id="ientry-idm140466932962752">Extreme Programming, <a class="indexterm" href="#test-first-programming">Test-First Programming</a>, <a class="indexterm" href="#other-uses-for-tests.agile-documentation">Agile Documentation</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt id="ientry-idm140466933251696">Failure, <a class="indexterm" href="#textui">The Command-Line Test Runner</a></dt><dt id="ientry-idm140466933183392">Fixture, <a class="indexterm" href="#fixtures">Fixtures</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt id="ientry-idm140466933213360">Incomplete Test, <a class="indexterm" href="#textui">The Command-Line Test Runner</a>, <a class="indexterm" href="#incomplete-tests">Incomplete Tests</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt id="ientry-idm140466933227936">Logfile, <a class="indexterm" href="#textui">The Command-Line Test Runner</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt id="ientry-idm140466932743136">Observer Pattern, <a class="indexterm" href="#stubs.self-shunting">Self-Shunting</a>, <a class="indexterm" href="#api.testresult">PHPUnit2_Framework_TestResult</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt id="ientry-idm140466932706272">Phing, <a class="indexterm" href="#phing">PHPUnit and Phing</a></dt><dt id="ientry-idm140466933015872">PHPUnit2_Extensions_ExceptionTestCase, <a class="indexterm" href="#testing-exceptions-and-performance-regressions.exceptions">Exceptions</a></dt><dt id="ientry-idm140466932997792">PHPUnit2_Extensions_PerformanceTestCase, <a class="indexterm" href="#testing-exceptions-and-performance-regressions.performance-regressions">Performance Regressions</a></dt><dt id="ientry-idm140466931422784">PHPUnit2_Extensions_RepeatedTest, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Extensions_TestDecorator">Subclass PHPUnit2_Extensions_TestDecorator</a></dt><dt id="ientry-idm140466931424912">PHPUnit2_Extensions_TestDecorator, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Extensions_TestDecorator">Subclass PHPUnit2_Extensions_TestDecorator</a></dt><dt id="ientry-idm140466933089424">PHPUnit2_Extensions_TestSetup, <a class="indexterm" href="#fixtures.suite-level-setup">Suite-Level Setup</a>, <a class="indexterm" href="#stubs">Stubs</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Extensions_TestDecorator">Subclass PHPUnit2_Extensions_TestDecorator</a></dt><dt id="ientry-idm140466932857744">PHPUnit2_Framework_Assert, <a class="indexterm" href="#test-first-programming.bankaccount-example">BankAccount Example</a>, <a class="indexterm" href="#api.assert">PHPUnit2_Framework_Assert</a>, <a class="indexterm" href="#extending-phpunit.Assert">Assert Classes</a></dt><dt id="ientry-idm140466932932992">PHPUnit2_Framework_IncompleteTest, <a class="indexterm" href="#incomplete-tests">Incomplete Tests</a></dt><dt id="ientry-idm140466932932240">PHPUnit2_Framework_IncompleteTestError, <a class="indexterm" href="#incomplete-tests">Incomplete Tests</a></dt><dt id="ientry-idm140466932362432">PHPUnit2_Framework_Test, <a class="indexterm" href="#implementation">PHPUnit's Implementation</a>, <a class="indexterm" href="#api.test">PHPUnit2_Framework_Test</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_Test">Implement PHPUnit2_Framework_Test</a></dt><dt id="ientry-idm140466933399968">PHPUnit2_Framework_TestCase, <a class="indexterm" href="#goals">PHPUnit's Goals</a>, <a class="indexterm" href="#api.testcase">PHPUnit2_Framework_TestCase</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_TestCase">Subclass PHPUnit2_Framework_TestCase</a></dt><dt id="ientry-idm140466931937008">PHPUnit2_Framework_TestListener, <a class="indexterm" href="#api.testresult">PHPUnit2_Framework_TestResult</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_TestListener">Implement PHPUnit2_Framework_TestListener</a></dt><dt id="ientry-idm140466932361680">PHPUnit2_Framework_TestResult, <a class="indexterm" href="#implementation">PHPUnit's Implementation</a>, <a class="indexterm" href="#api.testresult">PHPUnit2_Framework_TestResult</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_TestResult">Subclass PHPUnit2_Framework_TestResult</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_TestListener">Implement PHPUnit2_Framework_TestListener</a></dt><dt id="ientry-idm140466932350720">PHPUnit2_Framework_TestSuite, <a class="indexterm" href="#implementation">PHPUnit's Implementation</a>, <a class="indexterm" href="#api.testsuite">PHPUnit2_Framework_TestSuite</a>, <a class="indexterm" href="#extending-phpunit.PHPUnit2_Framework_TestListener">Implement PHPUnit2_Framework_TestListener</a></dt><dt id="ientry-idm140466933220640">PHPUnit2_Runner_TestSuiteLoader, <a class="indexterm" href="#textui">The Command-Line Test Runner</a></dt><dt id="ientry-idm140466932337440">Pluggable Selector, <a class="indexterm" href="#implementation">PHPUnit's Implementation</a></dt></dl></div><div class="indexdiv"><h3>R</h3><dl><dt id="ientry-idm140466932664016">Refactoring, <a class="indexterm" href="#other-uses-for-tests.refactoring">Refactoring</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt id="ientry-idm140466932745200">Self Shunt Pattern, <a class="indexterm" href="#stubs.self-shunting">Self-Shunting</a></dt><dt id="ientry-idm140466933119984">setUp(), <a class="indexterm" href="#fixtures">Fixtures</a>, <a class="indexterm" href="#implementation">PHPUnit's Implementation</a></dt><dt id="ientry-idm140466933214112">Skeleton Generator, <a class="indexterm" href="#textui">The Command-Line Test Runner</a></dt><dt id="ientry-idm140466932800656">Stubs, <a class="indexterm" href="#stubs">Stubs</a>, <a class="indexterm" href="#other-uses-for-tests.cross-team-tests">Cross-Team Tests</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt id="ientry-idm140466933119232">tearDown(), <a class="indexterm" href="#fixtures">Fixtures</a></dt><dt id="ientry-idm140466933120736">Template Method, <a class="indexterm" href="#fixtures">Fixtures</a></dt><dt id="ientry-idm140466932540272">Test Report, <a class="indexterm" href="#phing.formatting-feedback">Formatting Feedback</a></dt><dt id="ientry-idm140466932961936">Test-Driven Development, <a class="indexterm" href="#test-first-programming">Test-First Programming</a></dt><dt id="ientry-idm140466932890016">Test-First Programming, <a class="indexterm" href="#test-first-programming">Test-First Programming</a></dt><dt id="ientry-idm140466932687408">TestDox, <a class="indexterm" href="#other-uses-for-tests.agile-documentation">Agile Documentation</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt id="ientry-idm140466933562256">Unit Test, <a class="indexterm" href="#automating-tests">Automating Tests</a>, <a class="indexterm" href="#test-first-programming">Test-First Programming</a></dt></dl></div></div></div></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="appendixes.bibliography"></a>Appendix C. Bibliography</h1></div></div></div><div class="biblioentry"><a id="Astels2003"></a><p>[<abbr class="abbrev">Astels2003</abbr>] <span class="title"><em>Test Driven Development</em>. </span><span class="authorgroup"><span class="firstname">David</span> <span class="surname">Astels</span>. </span><span class="copyright">Copyright © 2003. </span><span class="publisher"><span class="publishername">Prentice Hall. </span></span><span class="isbn">ISBN 0131016490. </span></p></div><div class="biblioentry"><a id="Beck1997"></a><p>[<abbr class="abbrev">Beck1997</abbr>] <span class="title"><em>Smalltalk Best Practice Patterns</em>. </span><span class="authorgroup"><span class="firstname">Kent</span> <span class="surname">Beck</span>. </span><span class="copyright">Copyright © 1997. </span><span class="publisher"><span class="publishername">Prentice Hall. </span></span><span class="isbn">ISBN 0-13-476904-X. </span></p></div><div class="biblioentry"><a id="Beck2002"></a><p>[<abbr class="abbrev">Beck2002</abbr>] <span class="title"><em>Test Driven Development by Example</em>. </span><span class="authorgroup"><span class="firstname">Kent</span> <span class="surname">Beck</span>. </span><span class="copyright">Copyright © 2002. </span><span class="publisher"><span class="publishername">Addison-Wesley. </span></span><span class="isbn">ISBN 0-321-14653-0. </span></p></div><div class="biblioentry"><a id="Beck2004"></a><p>[<abbr class="abbrev">Beck2004</abbr>] <span class="title"><em>JUnit Pocket Guide</em>. </span><span class="subtitle">Quick Lookup and Advice. </span><span class="authorgroup"><span class="firstname">Kent</span> <span class="surname">Beck</span>. </span><span class="copyright">Copyright © 2004. </span><span class="publisher"><span class="publishername">O'Reilly Media. </span></span><span class="isbn">ISBN 0-596-00743-4. </span></p></div><div class="biblioentry"><a id="Bergmann2005"></a><p>[<abbr class="abbrev">Bergmann2005</abbr>] <span class="title"><em>Professionelle Softwareentwicklung mit PHP 5</em>. </span><span class="subtitle">Objektorientierung, Entwurfsmuster, Modellierung, Fortgeschrittene Datenbankprogrammierung. </span><span class="authorgroup"><span class="firstname">Sebastian</span> <span class="surname">Bergmann</span>. </span><span class="copyright">Copyright © 2005. </span><span class="publisher"><span class="publishername">dpunkt.verlag. </span></span><span class="isbn">ISBN 3-89864-229-1. </span></p></div><div class="biblioentry"><a id="GammaBeck1999"></a><p>[<abbr class="abbrev">GammaBeck1999</abbr>] <span class="title"><em>JUnit: A Cook's Tour</em>. </span><span class="authorgroup"><span class="firstname">Erich</span> <span class="surname">Gamma</span> and <span class="firstname">Kent</span> <span class="surname">Beck</span>. </span><span class="copyright">Copyright © 1999. </span><span class="publisher"><span class="publishername">http://junit.sourceforge.net/doc/cookstour/cookstour.htm. </span></span></p></div><div class="biblioentry"><a id="GuBaRe2005"></a><p>[<abbr class="abbrev">GuBaRe2005</abbr>] <span class="title"><em>PHP 5 Power Programming</em>. </span><span class="authorgroup"><span class="firstname">Andi</span> <span class="surname">Gutmans</span>, <span class="firstname">Stig</span> <span class="surname">Bakken</span>, and <span class="firstname">Derick</span> <span class="surname">Rethans</span>. </span><span class="copyright">Copyright © 2005. </span><span class="publisher"><span class="publishername">Prentice Hall. </span></span><span class="isbn">ISBN 0-131-47149-X. </span></p></div></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="appendixes.copyright"></a>Appendix D. Copyright</h1></div></div></div><pre class="programlisting">Copyright (c) 2005-2017 Sebastian Bergmann.

This work is licensed under the Creative Commons Attribution License.
To view a copy of this license, visit
http://creativecommons.org/licenses/by/2.0/ or send a letter to
Creative Commons, 559 Nathan Abbott Way, Stanford, California 94305,
USA.

A summary of the license is given below, followed by the full legal
text.

--------------------------------------------------------------------

You are free:

    * to copy, distribute, display, and perform the work
    * to make derivative works
    * to make commercial use of the work

Under the following conditions:

Attribution. You must give the original author credit.

    * For any reuse or distribution, you must make clear to others the
      license terms of this work.

    * Any of these conditions can be waived if you get permission from
      the author.

Your fair use and other rights are in no way affected by the above.

The above is a summary of the full license below.

====================================================================

Creative Commons Legal Code
Attribution 2.0

CREATIVE COMMONS CORPORATION IS NOT A LAW FIRM AND DOES NOT PROVIDE
LEGAL SERVICES. DISTRIBUTION OF THIS LICENSE DOES NOT CREATE AN
ATTORNEY-CLIENT RELATIONSHIP. CREATIVE COMMONS PROVIDES THIS
INFORMATION ON AN "AS-IS" BASIS. CREATIVE COMMONS MAKES NO WARRANTIES
REGARDING THE INFORMATION PROVIDED, AND DISCLAIMS LIABILITY FOR
DAMAGES RESULTING FROM ITS USE.

License

THE WORK (AS DEFINED BELOW) IS PROVIDED UNDER THE TERMS OF THIS
CREATIVE COMMONS PUBLIC LICENSE ("CCPL" OR "LICENSE"). THE WORK IS
PROTECTED BY COPYRIGHT AND/OR OTHER APPLICABLE LAW. ANY USE OF THE
WORK OTHER THAN AS AUTHORIZED UNDER THIS LICENSE OR COPYRIGHT LAW IS
PROHIBITED.

BY EXERCISING ANY RIGHTS TO THE WORK PROVIDED HERE, YOU ACCEPT AND
AGREE TO BE BOUND BY THE TERMS OF THIS LICENSE. THE LICENSOR GRANTS
YOU THE RIGHTS CONTAINED HERE IN CONSIDERATION OF YOUR ACCEPTANCE OF
SUCH TERMS AND CONDITIONS.

1. Definitions

   a. "Collective Work" means a work, such as a periodical issue,
      anthology or encyclopedia, in which the Work in its entirety in
      unmodified form, along with a number of other contributions,
      constituting separate and independent works in themselves, are
      assembled into a collective whole. A work that constitutes a
      Collective Work will not be considered a Derivative Work (as
      defined below) for the purposes of this License.

   b. "Derivative Work" means a work based upon the Work or upon the
      Work and other pre-existing works, such as a translation,
      musical arrangement, dramatization, fictionalization, motion
      picture version, sound recording, art reproduction, abridgment,
      condensation, or any other form in which the Work may be recast,
      transformed, or adapted, except that a work that constitutes a
      Collective Work will not be considered a Derivative Work for the
      purpose of this License. For the avoidance of doubt, where the
      Work is a musical composition or sound recording, the
      synchronization of the Work in timed-relation with a moving
      image ("synching") will be considered a Derivative Work for the
      purpose of this License.

   c. "Licensor" means the individual or entity that offers the Work
      under the terms of this License.

   d. "Original Author" means the individual or entity who created the Work.

   e. "Work" means the copyrightable work of authorship offered under
      the terms of this License.

   f. "You" means an individual or entity exercising rights under this
      License who has not previously violated the terms of this
      License with respect to the Work, or who has received express
      permission from the Licensor to exercise rights under this
      License despite a previous violation.

2. Fair Use Rights. Nothing in this license is intended to reduce,
   limit, or restrict any rights arising from fair use, first sale or
   other limitations on the exclusive rights of the copyright owner
   under copyright law or other applicable laws.

3. License Grant. Subject to the terms and conditions of this License,
   Licensor hereby grants You a worldwide, royalty-free,
   non-exclusive, perpetual (for the duration of the applicable
   copyright) license to exercise the rights in the Work as stated
   below:

   a. to reproduce the Work, to incorporate the Work into one or more
      Collective Works, and to reproduce the Work as incorporated in
      the Collective Works;

   b. to create and reproduce Derivative Works;

   c. to distribute copies or phonorecords of, display publicly,
      perform publicly, and perform publicly by means of a digital
      audio transmission the Work including as incorporated in
      Collective Works;

   d. to distribute copies or phonorecords of, display publicly,
      perform publicly, and perform publicly by means of a digital
      audio transmission Derivative Works.

   e.

      For the avoidance of doubt, where the work is a musical composition:

         i. Performance Royalties Under Blanket Licenses. Licensor
            waives the exclusive right to collect, whether
            individually or via a performance rights society
            (e.g. ASCAP, BMI, SESAC), royalties for the public
            performance or public digital performance (e.g. webcast)
            of the Work.

        ii. Mechanical Rights and Statutory Royalties. Licensor waives
            the exclusive right to collect, whether individually or
            via a music rights agency or designated agent (e.g. Harry
            Fox Agency), royalties for any phonorecord You create from
            the Work ("cover version") and distribute, subject to the
            compulsory license created by 17 USC Section 115 of the US
            Copyright Act (or the equivalent in other jurisdictions).

   f. Webcasting Rights and Statutory Royalties. For the avoidance of
      doubt, where the Work is a sound recording, Licensor waives the
      exclusive right to collect, whether individually or via a
      performance-rights society (e.g. SoundExchange), royalties for
      the public digital performance (e.g. webcast) of the Work,
      subject to the compulsory license created by 17 USC Section 114
      of the US Copyright Act (or the equivalent in other
      jurisdictions).

The above rights may be exercised in all media and formats whether now
known or hereafter devised. The above rights include the right to make
such modifications as are technically necessary to exercise the rights
in other media and formats. All rights not expressly granted by
Licensor are hereby reserved.

4. Restrictions.The license granted in Section 3 above is expressly
   made subject to and limited by the following restrictions:

   a. You may distribute, publicly display, publicly perform, or
      publicly digitally perform the Work only under the terms of this
      License, and You must include a copy of, or the Uniform Resource
      Identifier for, this License with every copy or phonorecord of
      the Work You distribute, publicly display, publicly perform, or
      publicly digitally perform. You may not offer or impose any
      terms on the Work that alter or restrict the terms of this
      License or the recipients' exercise of the rights granted
      hereunder. You may not sublicense the Work. You must keep intact
      all notices that refer to this License and to the disclaimer of
      warranties. You may not distribute, publicly display, publicly
      perform, or publicly digitally perform the Work with any
      technological measures that control access or use of the Work in
      a manner inconsistent with the terms of this License
      Agreement. The above applies to the Work as incorporated in a
      Collective Work, but this does not require the Collective Work
      apart from the Work itself to be made subject to the terms of
      this License. If You create a Collective Work, upon notice from
      any Licensor You must, to the extent practicable, remove from
      the Collective Work any reference to such Licensor or the
      Original Author, as requested. If You create a Derivative Work,
      upon notice from any Licensor You must, to the extent
      practicable, remove from the Derivative Work any reference to
      such Licensor or the Original Author, as requested.

   b. If you distribute, publicly display, publicly perform, or
      publicly digitally perform the Work or any Derivative Works or
      Collective Works, You must keep intact all copyright notices for
      the Work and give the Original Author credit reasonable to the
      medium or means You are utilizing by conveying the name (or
      pseudonym if applicable) of the Original Author if supplied; the
      title of the Work if supplied; to the extent reasonably
      practicable, the Uniform Resource Identifier, if any, that
      Licensor specifies to be associated with the Work, unless such
      URI does not refer to the copyright notice or licensing
      information for the Work; and in the case of a Derivative Work,
      a credit identifying the use of the Work in the Derivative Work
      (e.g., "French translation of the Work by Original Author," or
      "Screenplay based on original Work by Original Author"). Such
      credit may be implemented in any reasonable manner; provided,
      however, that in the case of a Derivative Work or Collective
      Work, at a minimum such credit will appear where any other
      comparable authorship credit appears and in a manner at least as
      prominent as such other comparable authorship credit.

5. Representations, Warranties and Disclaimer

UNLESS OTHERWISE MUTUALLY AGREED TO BY THE PARTIES IN WRITING,
LICENSOR OFFERS THE WORK AS-IS AND MAKES NO REPRESENTATIONS OR
WARRANTIES OF ANY KIND CONCERNING THE WORK, EXPRESS, IMPLIED,
STATUTORY OR OTHERWISE, INCLUDING, WITHOUT LIMITATION, WARRANTIES OF
TITLE, MERCHANTIBILITY, FITNESS FOR A PARTICULAR PURPOSE,
NONINFRINGEMENT, OR THE ABSENCE OF LATENT OR OTHER DEFECTS, ACCURACY,
OR THE PRESENCE OF ABSENCE OF ERRORS, WHETHER OR NOT
DISCOVERABLE. SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION OF IMPLIED
WARRANTIES, SO SUCH EXCLUSION MAY NOT APPLY TO YOU.

6. Limitation on Liability. EXCEPT TO THE EXTENT REQUIRED BY
   APPLICABLE LAW, IN NO EVENT WILL LICENSOR BE LIABLE TO YOU ON ANY
   LEGAL THEORY FOR ANY SPECIAL, INCIDENTAL, CONSEQUENTIAL, PUNITIVE
   OR EXEMPLARY DAMAGES ARISING OUT OF THIS LICENSE OR THE USE OF THE
   WORK, EVEN IF LICENSOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
   DAMAGES.

7. Termination

   a. This License and the rights granted hereunder will terminate
      automatically upon any breach by You of the terms of this
      License. Individuals or entities who have received Derivative
      Works or Collective Works from You under this License, however,
      will not have their licenses terminated provided such
      individuals or entities remain in full compliance with those
      licenses. Sections 1, 2, 5, 6, 7, and 8 will survive any
      termination of this License.

   b. Subject to the above terms and conditions, the license granted
      here is perpetual (for the duration of the applicable copyright
      in the Work). Notwithstanding the above, Licensor reserves the
      right to release the Work under different license terms or to
      stop distributing the Work at any time; provided, however that
      any such election will not serve to withdraw this License (or
      any other license that has been, or is required to be, granted
      under the terms of this License), and this License will continue
      in full force and effect unless terminated as stated above.

8. Miscellaneous

   a. Each time You distribute or publicly digitally perform the Work
      or a Collective Work, the Licensor offers to the recipient a
      license to the Work on the same terms and conditions as the
      license granted to You under this License.

   b. Each time You distribute or publicly digitally perform a
      Derivative Work, Licensor offers to the recipient a license to
      the original Work on the same terms and conditions as the
      license granted to You under this License.

   c. If any provision of this License is invalid or unenforceable
      under applicable law, it shall not affect the validity or
      enforceability of the remainder of the terms of this License,
      and without further action by the parties to this agreement,
      such provision shall be reformed to the minimum extent necessary
      to make such provision valid and enforceable.

   d. No term or provision of this License shall be deemed waived and
      no breach consented to unless such waiver or consent shall be in
      writing and signed by the party to be charged with such waiver
      or consent.

   e. This License constitutes the entire agreement between the
      parties with respect to the Work licensed here. There are no
      understandings, agreements or representations with respect to
      the Work not specified here. Licensor shall not be bound by any
      additional provisions that may appear in any communication from
      You. This License may not be modified without the mutual written
      agreement of the Licensor and You.

Creative Commons is not a party to this License, and makes no warranty
whatsoever in connection with the Work. Creative Commons will not be
liable to You or any party on any legal theory for any damages
whatsoever, including without limitation any general, special,
incidental or consequential damages arising in connection to this
license. Notwithstanding the foregoing two (2) sentences, if Creative
Commons has expressly identified itself as the Licensor hereunder, it
shall have all rights and obligations of Licensor.

Except for the limited purpose of indicating to the public that the
Work is licensed under the CCPL, neither party will use the trademark
"Creative Commons" or any related trademark or logo of Creative
Commons without the prior written consent of Creative Commons. Any
permitted use will be in compliance with Creative Commons'
then-current trademark usage guidelines, as may be published on its
website or otherwise made available upon request from time to time.

Creative Commons may be contacted at http://creativecommons.org/.

====================================================================</pre></div></div></body></html>