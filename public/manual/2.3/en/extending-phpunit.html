<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>PHPUnit Manual &#8211; Chapter 15. Extending PHPUnit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="https://phpunit.de/manual/current/en/extending-phpunit.html">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/highlight.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700%7CSource+Code+Pro:400,700' rel='stylesheet' type='text/css'>
  <!--[if lt IE 9]><script src="js/html5shiv.min.js"></script><![endif]-->
 </head>
 <body>
  <nav class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-left">
            <li>
                <a href="https://phpunit.de/documentation.html">This documentation is outdated. Please follow this link to learn about the new documentation.</a>
            </li>
        </ul>
    </div>
  </nav>
  <div class="container-fluid">
   <div class="row">
    <div class="col-md-4 col-lg-3">
     <div class="well well-sm sidebar-nav">
<dl class="toc nav hidden-print"><dt><span class="preface"><a href="preface.html">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="preface.html#preface.requirements">Requirements</a></span></dt><dt><span class="section"><a href="preface.html#preface.license">This Book Is Free</a></span></dt><dt><span class="section"><a href="preface.html#preface.conventions">Conventions Used in This Book</a></span></dt><dt><span class="section"><a href="preface.html#preface.acknowledgements">Acknowledgements</a></span></dt></dl></dd><dt><span class="chapter"><a href="automating-tests.html">1. Automating Tests</a></span></dt><dt><span class="chapter"><a href="goals.html">2. PHPUnit's Goals</a></span></dt><dt><span class="chapter"><a href="installation.html">3. Installing PHPUnit</a></span></dt><dt><span class="chapter"><a href="textui.html">4. The Command-Line Test Runner</a></span></dt><dt><span class="chapter"><a href="fixtures.html">5. Fixtures</a></span></dt><dd><dl><dt><span class="section"><a href="fixtures.html#fixtures.more-setup-than-teardown">More setUp() than tearDown()</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.variations">Variations</a></span></dt><dt><span class="section"><a href="fixtures.html#fixtures.suite-level-setup">Suite-Level Setup</a></span></dt></dl></dd><dt><span class="chapter"><a href="testing-exceptions-and-performance-regressions.html">6. Testing Exceptions and Performance Regressions</a></span></dt><dd><dl><dt><span class="section"><a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.exceptions">Exceptions</a></span></dt><dt><span class="section"><a href="testing-exceptions-and-performance-regressions.html#testing-exceptions-and-performance-regressions.performance-regressions">Performance Regressions</a></span></dt></dl></dd><dt><span class="chapter"><a href="incomplete-tests.html">7. Incomplete Tests</a></span></dt><dt><span class="chapter"><a href="test-first-programming.html">8. Test-First Programming</a></span></dt><dd><dl><dt><span class="section"><a href="test-first-programming.html#test-first-programming.bankaccount-example">BankAccount Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="code-coverage-analysis.html">9. Code-Coverage Analysis</a></span></dt><dt><span class="chapter"><a href="stubs.html">10. Stubs</a></span></dt><dd><dl><dt><span class="section"><a href="stubs.html#stubs.self-shunting">Self-Shunting</a></span></dt></dl></dd><dt><span class="chapter"><a href="other-uses-for-tests.html">11. Other Uses for Tests</a></span></dt><dd><dl><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.agile-documentation">Agile Documentation</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.cross-team-tests">Cross-Team Tests</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.debugging-tests">Debugging Tests</a></span></dt><dt><span class="section"><a href="other-uses-for-tests.html#other-uses-for-tests.refactoring">Refactoring</a></span></dt></dl></dd><dt><span class="chapter"><a href="phing.html">12. PHPUnit and Phing</a></span></dt><dd><dl><dt><span class="section"><a href="phing.html#phing.formatting-feedback">Formatting Feedback</a></span></dt></dl></dd><dt><span class="chapter"><a href="implementation.html">13. PHPUnit's Implementation</a></span></dt><dt><span class="chapter"><a href="api.html">14. PHPUnit API</a></span></dt><dd><dl><dt><span class="section"><a href="api.html#api.overview">Overview</a></span></dt><dt><span class="section"><a href="api.html#api.assert">PHPUnit2_Framework_Assert</a></span></dt><dt><span class="section"><a href="api.html#api.test">PHPUnit2_Framework_Test</a></span></dt><dt><span class="section"><a href="api.html#api.testcase">PHPUnit2_Framework_TestCase</a></span></dt><dt><span class="section"><a href="api.html#api.testsuite">PHPUnit2_Framework_TestSuite</a></span></dt><dt><span class="section"><a href="api.html#api.testresult">PHPUnit2_Framework_TestResult</a></span></dt><dt><span class="section"><a href="api.html#api.package-structure">Package Structure</a></span></dt></dl></dd><dt><span class="chapter"><a href="extending-phpunit.html" class="active">15. Extending PHPUnit</a></span></dt><dd><dl><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_TestCase">Subclass PHPUnit2_Framework_TestCase</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.Assert">Assert Classes</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Extensions_TestDecorator">Subclass PHPUnit2_Extensions_TestDecorator</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_Test">Implement PHPUnit2_Framework_Test</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_TestResult">Subclass PHPUnit2_Framework_TestResult</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.PHPUnit2_Framework_TestListener">Implement PHPUnit2_Framework_TestListener</a></span></dt><dt><span class="section"><a href="extending-phpunit.html#extending-phpunit.TestRunner">New Test Runner</a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.phpunit1.html">A. PHPUnit for PHP 4</a></span></dt><dt><span class="appendix"><a href="appendixes.index.html">B. Index</a></span></dt><dd><dl><dt><span class="index"><a href="appendixes.index.html#appendixes.index.index"></a></span></dt></dl></dd><dt><span class="appendix"><a href="appendixes.bibliography.html">C. Bibliography</a></span></dt><dt><span class="appendix"><a href="appendixes.copyright.html">D. Copyright</a></span></dt></dl>
     </div>
    </div>
    <div class="col-md-8 col-lg-9">
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="api.html">Prev</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="appendixes.phpunit1.html">Next</a></div>
     </div>
<div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="extending-phpunit"></a>Chapter 15. Extending PHPUnit</h1></div></div></div><div class="alert alert-warning"><h3 class="title">Caution</h3><p>
      You are looking at the documentation for a version of PHPUnit that is no
      longer supported.
    </p><p>
      The documentation for the current version of PHPUnit can be found
      <a class="ulink" href="../../current/en/index.html" target="_top">here</a>.
    </p></div><p>
    PHPUnit can be extended in various ways to make the writing of tests
    easier and customize the feedback you get from running tests. Here are
    common starting points to extend PHPUnit.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_TestCase"></a>Subclass PHPUnit2_Framework_TestCase</h2></div></div></div><p>
      <a id="idm140250593317696" class="indexterm"></a>

      Write utility methods in an abstract subclass of
      <code class="literal">PHPUnit2_Framework_TestCase</code> and derive your test case
      classes from that class. This is one of the easiest ways to extend
      PHPUnit.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.Assert"></a>Assert Classes</h2></div></div></div><p>
      <a id="idm140250593314464" class="indexterm"></a>
      <a id="idm140250593313680" class="indexterm"></a>

      Write your own class with assertions special to your purpose.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Extensions_TestDecorator"></a>Subclass PHPUnit2_Extensions_TestDecorator</h2></div></div></div><p>
      <a id="idm140250593311072" class="indexterm"></a>

      You can wrap test cases or test suites in a subclass of
      <code class="literal">PHPUnit2_Extensions_TestDecorator</code> and use the
      Decorator design pattern to perform some actions before and after the
      test runs.
    </p><p>
      <a id="idm140250593308944" class="indexterm"></a>
      <a id="idm140250593308112" class="indexterm"></a>

      PHPUnit ships with two concrete test decorators:
      <code class="literal">PHPUnit2_Extensions_RepeatedTest</code> and
      <code class="literal">PHPUnit2_Extensions_TestSetup</code>. The former is used to
      run a test repeatedly and only count it as a success if all iterations
      are successful. The latter was discussed in <a class="xref" href="fixtures.html" title="Chapter 5. Fixtures">Chapter 5</a>.
    </p><p>
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.RepeatedTest.php" title="Example 15.1: The RepeatedTest Decorator">Example 15.1</a>
      shows a cut-down version of the <code class="literal">PHPUnit2_Extensions_RepeatedTest</code>
      test decorator that illustrates how to write your own test decorators.
    </p><div class="example"><a id="extending-phpunit.examples.RepeatedTest.php"></a><p class="title"><strong>Example 15.1: The RepeatedTest Decorator</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Extensions/TestDecorator.php';

class PHPUnit2_Extensions_RepeatedTest extends PHPUnit2_Extensions_TestDecorator {
    private $timesRepeat = 1;

    public function __construct(PHPUnit2_Framework_Test $test, $timesRepeat = 1) {
        parent::__construct($test);

        if (is_integer($timesRepeat) &amp;&amp;
            $timesRepeat &gt;= 0) {
            $this-&gt;timesRepeat = $timesRepeat;
        }
    }

    public function countTestCases() {
        return $this-&gt;timesRepeat * $this-&gt;test-&gt;countTestCases();
    }

    public function run($result = NULL) {
        if ($result === NULL) {
            $result = $this-&gt;createResult();
        }

        for ($i = 0; $i &lt; $this-&gt;timesRepeat &amp;&amp; !$result-&gt;shouldStop(); $i++) {
            $this-&gt;test-&gt;run($result);
        }

        return $result;
    }
}
?&gt;</pre></div></div><br class="example-break"></br></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_Test"></a>Implement PHPUnit2_Framework_Test</h2></div></div></div><p>
      <a id="idm140250593298400" class="indexterm"></a>
      <a id="idm140250593297648" class="indexterm"></a>

      The <code class="literal">PHPUnit2_Framework_Test</code> interface is narrow and
      easy to implement. You can write an implementation of
      <code class="literal">PHPUnit2_Framework_Test</code> that is simpler than
      <code class="literal">PHPUnit2_Framework_TestCase</code> and that runs
      <span class="emphasis"><em>data-driven tests</em></span>, for instance.
    </p><p>
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.DataDrivenTest.php" title="Example 15.2: A data-driven test">Example 15.2</a>
      shows a data-driven test-case class that compares values from a file
      with Comma-Separated Values (CSV). Each line of such a file looks like
      <code class="literal">foo;bar</code>, where the first value is the one we expect
      and the second value is the actual one.
    </p><div class="example"><a id="extending-phpunit.examples.DataDrivenTest.php"></a><p class="title"><strong>Example 15.2: A data-driven test</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/Assert.php';
require_once 'PHPUnit2/Framework/Test.php';
require_once 'PHPUnit2/Framework/TestResult.php';

class DataDrivenTest implements PHPUnit2_Framework_Test {
    private $lines;

    public function __construct($dataFile) {
        $this-&gt;lines = file($dataFile);
    }

    public function countTestCases() {
        return sizeof($this-&gt;lines);
    }

    public function run($result = NULL) {
        if ($result === NULL) {
            $result = new PHPUnit2_Framework_TestResult;
        }

        $result-&gt;startTest($this);

        foreach ($this-&gt;lines as $line) {
            list($expected, $actual) = explode(';', $line);

            try {
                PHPUnit2_Framework_Assert::assertEquals(trim($expected), trim($actual));
            }

            catch (PHPUnit2_Framework_ComparisonFailure $e) {
                $result-&gt;addFailure($this, $e);
            }

            catch (Exception $e) {
                $result-&gt;addError($this, $e);
            }
        }

        $result-&gt;endTest($this);

        return $result;
    }
}

$test   = new DataDrivenTest('data_file.csv');
$result = $test-&gt;run();

$failures = $result-&gt;failures();
print $failures[0]-&gt;thrownException()-&gt;toString();
?&gt;</pre><pre class="screen">expected: &lt;foo&gt; but was: &lt;bar&gt;</pre></div></div><br class="example-break"></br></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_TestResult"></a>Subclass PHPUnit2_Framework_TestResult</h2></div></div></div><p>
      <a id="idm140250593286880" class="indexterm"></a>

      By passing a special-purpose <code class="literal">PHPUnit2_Framework_TestResult</code>
      object to the <code class="literal">run()</code> method, you can change the way
      tests are run and what result data gets collected.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.PHPUnit2_Framework_TestListener"></a>Implement PHPUnit2_Framework_TestListener</h2></div></div></div><p>
      <a id="idm140250593282896" class="indexterm"></a>
      <a id="idm140250593282064" class="indexterm"></a>

      You do not necessarily need to write a whole subclass of
      <code class="literal">PHPUnit2_Framework_TestResult</code> in order to customize
      it. Most of the time, it will suffice to implement a new
      <code class="literal">PHPUnit2_Framework_TestListener</code>
      (see <a class="xref" href="api.html#api.testresult.tables.testlistener" title="Table 14.10. TestListener Callbacks">Table 14.10</a>) and attach
      it to the <code class="literal">PHPUnit2_Framework_TestResult</code> object, before
      running the tests.
    </p><p>
      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.SimpleTestListener.php" title="Example 15.3: A simple test listener">Example 15.3</a>
      shows a simple implementation of the <code class="literal">PHPUnit2_Framework_TestListener</code>
      interface.
    </p><div class="example"><a id="extending-phpunit.examples.SimpleTestListener.php"></a><p class="title"><strong>Example 15.3: A simple test listener</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestListener.php';

class SimpleTestListener
implements PHPUnit2_Framework_TestListener {
  public function
  addError(PHPUnit2_Framework_Test $test, Exception $e) {
    printf(
      "Error while running test '%s'.\n",
      $test-&gt;getName()
    );
  }

  public function
  addFailure(PHPUnit2_Framework_Test $test,
             PHPUnit2_Framework_AssertionFailedError $e) {
    printf(
      "Test '%s' failed.\n",
      $test-&gt;getName()
    );
  }

  public function
  addIncompleteTest(PHPUnit2_Framework_Test $test,
                    Exception $e) {
    printf(
      "Test '%s' is incomplete.\n",
      $test-&gt;getName()
    );
  }

  public function startTest(PHPUnit2_Framework_Test $test) {
    printf(
      "Test '%s' started.\n",
      $test-&gt;getName()
    );
  }

  public function endTest(PHPUnit2_Framework_Test $test) {
    printf(
      "Test '%s' ended.\n",
      $test-&gt;getName()
    );
  }

  public function
  startTestSuite(PHPUnit2_Framework_TestSuite $suite) {
    printf(
      "TestSuite '%s' started.\n",
      $suite-&gt;getName()
    );
  }

  public function
  endTestSuite(PHPUnit2_Framework_TestSuite $suite) {
    printf(
      "TestSuite '%s' ended.\n",
      $suite-&gt;getName()
    );
  }
}
?&gt;</pre></div></div><br class="example-break"></br><p>
      <a id="idm140250593274288" class="indexterm"></a>
      <a id="idm140250593273456" class="indexterm"></a>

      <a class="xref" href="extending-phpunit.html#extending-phpunit.examples.SimpleTestListener-example.php" title="Example 15.4: Running and observing a test suite">Example 15.4</a>
      shows how to run and observe a test suite.
    </p><div class="example"><a id="extending-phpunit.examples.SimpleTestListener-example.php"></a><p class="title"><strong>Example 15.4: Running and observing a test suite</strong></p><div class="example-contents"><pre class="programlisting">&lt;?php
require_once 'PHPUnit2/Framework/TestResult.php';
require_once 'PHPUnit2/Framework/TestSuite.php';

require_once 'ArrayTest.php';
require_once 'SimpleTestListener.php';

// Create a test suite that contains the tests
// from the ArrayTest class.
$suite = new PHPUnit2_Framework_TestSuite('ArrayTest');

// Create a test result and attach a SimpleTestListener
// object as an observer to it.
$result = new PHPUnit2_Framework_TestResult;
$result-&gt;addListener(new SimpleTestListener);

// Run the tests.
$suite-&gt;run($result);
?&gt;</pre><pre class="screen">TestSuite 'ArrayTest' started.
Test 'testNewArrayIsEmpty' started.
Test 'testNewArrayIsEmpty' ended.
Test 'testArrayContainsAnElement' started.
Test 'testArrayContainsAnElement' ended.
TestSuite 'ArrayTest' ended.</pre></div></div><br class="example-break"></br></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="extending-phpunit.TestRunner"></a>New Test Runner</h2></div></div></div><p>
      If you need different feedback from the test execution, write your own
      test runner, interactive or not. The abstract
      <code class="literal">PHPUnit2_Runner_BaseTestRunner</code> class, which the
      <code class="literal">PHPUnit2_TextUI_TestRunner</code> class (the PHPUnit
      command-line test runner) inherits from, can be a starting point for
      this.
    </p></div></div>
     <div class="row">
      <div class="col-md-1 pull-left prev-nav"><a accesskey="p" href="api.html">Prev</a></div>
      <div class="col-md-1 pull-right next-nav"><a accesskey="n" href="appendixes.phpunit1.html">Next</a></div>
     </div>
    </div>
   </div>
   <hr/>
   <footer>
    <p><a href="appendixes.copyright.html">Copyright</a> &copy; 2005-2017 <a href="http://sebastian-bergmann.de/">Sebastian Bergmann</a>.</p>
   </footer>
  </div>
  <script src="js/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/highlight.pack.js"></script>
  <script type="text/javascript">
  $(document).ready(function() { $('pre.programlisting').each(function(i, e) {hljs.highlightBlock(e)}); });
  </script>
 </body>
</html>
